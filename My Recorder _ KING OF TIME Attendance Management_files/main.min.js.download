window.Recorder={Consts:{VERSION:"1.4.16",GATEWAY_BASE:"/gateway/bprgateway",GATEWAY_OPENID_CONNECT:"/oidc/myrecorder",HistoryStatus:{NONE:0,RESULT_OK:1,RESULT_NG:2,SAVED_LOCAL:3,LOCAL_SEND_OK:4,LOCAL_SEND_NG:5},CredentialCode:{CLICK:40,PASSWORD:41,CLICK_LOCATION:42,PASSWORD_LOCATION:43,CAMERA:48,CAMERA_PASSWORD:49,CAMERA_LOCATION:50,CAMREA_LOCATION_PASSWORD:51},ErrorCode:{AJAX_ERROR:"-1",XHR_STATUS_OFFLINE:"-1"},LocalTmpStatus:{SENDED:0,RE_SEND:1},ImageResult:{NONE:"0",RESULT_OK:"1",MIME_TYPE_ERROR:"2",IMAGE_SIZE_ERROR:"3",TARGET_RECORD_NONE:"4",EXCEPTION_OCCURED:"999"}},userData:{},i18N:{},storage:{},notification:{},network:{},utility:{},factory:{},modal:{},announce:{},view:{},geolocation:{},watch:{},useMedia:{},control:{},serviceWorkerMessage:{}};window.onload=function(){Recorder.network.initAjaxSetting();Recorder.view.init(Recorder.utility.isOldAndroid());Recorder.modal.init(Recorder.utility.isOldAndroid());Recorder.useMedia.init();Recorder.control.init();document.title=Recorder.i18N.getTitleName();$(window).resize(function(){Recorder.view.adjustButtonAlign(Recorder.control.nowCountShowing)});$(window).focus(function(){Recorder.control.refresh()});$(document).on("visibilitychange",function(){if(document.visibilityState=="hidden"){}else{Recorder.control.refresh()}});Recorder.view.cache.timerecorders.on("change",Recorder.control.init)};(function(){var browserLanguage="en";try{if((navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2).toLowerCase()==="ja"){browserLanguage="ja"}}catch(e){browserLanguage="en"}var keyPrefix="BrowserPersonalRecorder";function i18N(){this.defaultMessageMap={ja:{BrowserPersonalRecorder001:"このアカウントは利用できません。",BrowserPersonalRecorder002:"このIPアドレスからはアクセスできません。",BrowserPersonalRecorder003:"当機能はご利用できません。企業管理者にお問い合わせください。",BrowserPersonalRecorder004:"サーバーへの接続に失敗しました。",BrowserPersonalRecorder005:"ご使用のブラウザではご利用いただけません。",BrowserPersonalRecorder006:"HTTPSで接続してください。",BrowserPersonalRecorder007:"データを取得しました",BrowserPersonalRecorder035:"ID,パスワードを入力してください",BrowserPersonalRecorder036:"ID",BrowserPersonalRecorder037:"パスワード",BrowserPersonalRecorder038:"OK",BrowserPersonalRecorder057:"このアカウントはロックされている為、利用できません。ロックを解除する為には管理者にご連絡ください。",BrowserPersonalRecorder058:"認証に失敗し、アカウントがロックされました。ロックを解除する為には管理者にご連絡ください。",BrowserPersonalRecorder059:"認証に失敗しました。ID,パスワードをご確認ください。",BrowserPersonalRecorder060:"入社日以前の為、利用できません。",BrowserPersonalRecorder061:"退職日以降の為、利用できません。",BrowserPersonalRecorder066:"アプリケーションが更新されました。今すぐ再読み込みしますか？",BrowserPersonalRecorder070:"KING OF TIMEのMyレコーダを使ったアクセスでない可能性があります。一度ブラウザを閉じ、ブラウザのキャッシュをクリアしてから再度ログインをお試しください。",BrowserPersonalRecorder095:"My Recorder",BrowserPersonalRecorder097:'<br><p style="margin-bottom:1em;">ログインURLが変更になりました。</p><p><a href="https://nec.kingtime.jp/independent/recorder/personal">こちら</a>にアクセスしてください。</p>',BrowserPersonalRecorder098:"このユーザの通常ログインは許可されていません",BrowserPersonalRecorder099:"外部IDでログイン画面へ",BrowserPersonalRecorder100:"外部IDでログイン",BrowserPersonalRecorder101:"企業コード",BrowserPersonalRecorder103:"企業コードを入力してください",BrowserPersonalRecorder104:"接続先IdPを選択",BrowserPersonalRecorder105:"接続先IdP",BrowserPersonalRecorder106:"接続先IdPを選択してください",BrowserPersonalRecorder107:"SAMLによる認証に失敗しました",BrowserPersonalRecorder109:"タイムアウトしました",BrowserPersonalRecorder110:"アカウント連携済ユーザーが存在しません。アカウント連携設定を行ってください。",BrowserPersonalRecorder111:"認証処理でエラーが発生しました",BrowserPersonalRecorder112:"企業コード",BrowserPersonalRecorder113:"ユーザー名",BrowserPersonalRecorder114:"ユーザー種別",BrowserPersonalRecorder115:"ログイン",BrowserPersonalRecorder116:"認証に失敗しました。",BrowserPersonalRecorder117:"認証コード",BrowserPersonalRecorder118:"2要素認証コードを入力してください。",BrowserPersonalRecorder119:"入力された認証コードは無効です。もう一度やり直してください。"},en:{BrowserPersonalRecorder001:"This account cannot be used.",BrowserPersonalRecorder002:"IP is not allowed to access.",BrowserPersonalRecorder003:"This function is unavailable. Please contact the master admin.",BrowserPersonalRecorder004:"Failed to access to server.",BrowserPersonalRecorder005:"Your browser is not supported.",BrowserPersonalRecorder006:"Please connect with HTTPS.",BrowserPersonalRecorder007:"Data has been obtained.",BrowserPersonalRecorder035:"Please enter ID and password",BrowserPersonalRecorder036:"ID",BrowserPersonalRecorder037:"Password",BrowserPersonalRecorder038:"OK",BrowserPersonalRecorder057:"This account cannot be used because it is locked. If you would like to unlock the account, please contact the admin.",BrowserPersonalRecorder058:"Account has been locked due to authentication failure. Please contact the admin to clear lock.",BrowserPersonalRecorder059:"Failed to authenticate. Please check your ID and password.",BrowserPersonalRecorder060:"You are not allowed to use this because it is before the hiring date.",BrowserPersonalRecorder061:"You are not allowed to use this because it is after the resignation date.",BrowserPersonalRecorder066:"There is an update with the application. Would you like to re-load?",BrowserPersonalRecorder070:"You may not be accessed using My Recorder. Please close your browser, clear your browser cache and try again.",BrowserPersonalRecorder095:"My Recorder",BrowserPersonalRecorder097:'<br><p style="margin-bottom:1em;">Login URL has changed. </p><p>Please login from <a href="https://nec.kingtime.jp/independent/recorder/personal">here.</a></p>',BrowserPersonalRecorder098:"Normal sign in is not allowed for this user",BrowserPersonalRecorder099:"Go to sign in screen with external ID",BrowserPersonalRecorder100:"Sign in with external ID",BrowserPersonalRecorder101:"Company code",BrowserPersonalRecorder103:"Please enter the company code",BrowserPersonalRecorder104:"Select connecting IdP",BrowserPersonalRecorder105:"Connecting IdP",BrowserPersonalRecorder106:"Please select connecting IdP",BrowserPersonalRecorder107:"Authentication by SAML has failed",BrowserPersonalRecorder109:"Timeout, sir.",BrowserPersonalRecorder110:"There are no users with linked accounts. Please set up account linking.",BrowserPersonalRecorder111:"An error has occurred in the authentication process.",BrowserPersonalRecorder112:"Company Code",BrowserPersonalRecorder113:"User name",BrowserPersonalRecorder114:"User Type",BrowserPersonalRecorder115:"Login",BrowserPersonalRecorder117:"Authentication code",BrowserPersonalRecorder118:"Please enter authentication code",BrowserPersonalRecorder119:"The authentication code entered is invalid. Please try again."}};this.messageMap=null}i18N.prototype.setMessageMap=function(messageMap){this.messageMap=messageMap};i18N.prototype.getMessage=function(key){var message="";if(!this.messageMap){message=this.defaultMessageMap[browserLanguage][keyPrefix+key]}else{message=this.messageMap[keyPrefix+key]}return message||key};i18N.prototype.getHistoryStatusMessage=function(statusCode){if(!statusCode){return""}switch(statusCode){case Recorder.Consts.HistoryStatus.RESULT_OK:return this.getMessage("038");case Recorder.Consts.HistoryStatus.RESULT_NG:return this.getMessage("051");case Recorder.Consts.HistoryStatus.SAVED_LOCAL:return this.getMessage("052");case Recorder.Consts.HistoryStatus.LOCAL_SEND_OK:return this.getMessage("053");case Recorder.Consts.HistoryStatus.LOCAL_SEND_NG:return this.getMessage("054");default:return""}};i18N.prototype.getAccountErrorMessage=function(errorCode){if(!errorCode){return this.getMessage("004")}switch(errorCode){case"000":case"001":case"998":case"999":return this.getMessage("004");case"002":case"003":case"004":case"005":return this.getMessage("001");case"006":return this.getMessage("002");case"007":return this.getMessage("003");case"008":return this.getMessage("057");case"009":return this.getMessage("058");case"010":return this.getMessage("059");case"011":return this.getMessage("070");case"012":return this.getMessage("098");case"101":return this.getMessage("060");case"102":return this.getMessage("061");case"109":return this.getMessage("109");case"110":return this.getMessage("110");case"111":return this.getMessage("111");case"113":return this.getMessage("119");default:return this.getMessage("004")}};i18N.prototype.getRecordErrorMessage=function(errorCode){if(!errorCode){return this.getMessage("025")}switch(errorCode){case"006":return this.getMessage("002");case"000":case"001":case"999":return this.getMessage("018");case"002":case"003":case"004":case"005":return this.getMessage("019");case"101":return this.getMessage("020");case"102":return this.getMessage("021");case"104":case"107":return this.getMessage("022");case"103":case"105":return this.getMessage("023");case"106":return this.getMessage("106");case"998":return this.getMessage("025");default:return this.getMessage("018")}};i18N.prototype.getLocationErrorMessage=function(errorCode){if(!errorCode){return this.getMessage("045")}switch(errorCode){case -1:return this.getMessage("055");case 100:return this.getMessage("046");case 200:return this.getMessage("047");case 300:return this.getMessage("048");case 998:return this.getMessage("056");case 999:return this.getMessage("045");default:return this.getMessage("045")}};i18N.prototype.getWeekDayString=function(weekDay){if(!weekDay){return""}switch(weekDay){case 0:return this.getMessage("069");case 1:return this.getMessage("070");case 2:return this.getMessage("071");case 3:return this.getMessage("072");case 4:return this.getMessage("073");case 5:return this.getMessage("074");case 6:return this.getMessage("075");default:return""}};i18N.prototype.setWeekDayString=function(){moment.updateLocale("ja",{weekdaysShort:[this.getMessage("069"),this.getMessage("070"),this.getMessage("071"),this.getMessage("072"),this.getMessage("073"),this.getMessage("074"),this.getMessage("075")]})};i18N.prototype.getYearToDateStringWithWeekDay=function(date){this.setWeekDayString();var now=moment(date);var output=now.format(this.getMessage("096"));return output};i18N.prototype.getImageSendErrorMessage=function(imageResult){if(!imageResult){return""}switch(imageResult){case Recorder.Consts.ImageResult.MIME_TYPE_ERROR:return this.getMessage("079");case Recorder.Consts.ImageResult.IMAGE_SIZE_ERROR:return this.getMessage("080");case Recorder.Consts.ImageResult.TARGET_RECORD_NONE:return this.getMessage("081");case Recorder.Consts.ImageResult.EXCEPTION_OCCURED:return this.getMessage("082");default:return""}};i18N.prototype.getTitleName=function(){var appName=this.getMessage("095");var productName=this.getMessage("-1");if(productName&&productName!=="-1"){return appName+" | "+productName}return appName};Recorder=Recorder||{};Recorder.i18N=new i18N()})();(function($){var keys={ENVIRONMENT:"PARSONAL_BROWSER_RECORDER@ENVIRONMENT",SETTING:"PARSONAL_BROWSER_RECORDER@SETTING",ANNOUNCE:"PARSONAL_BROWSER_RECORDER@ANNOUNCE",ADMIN_MESSAGE:"PARSONAL_BROWSER_RECORDER@ADMIN_MESSAGE",LOCAL_RECORD:"PARSONAL_BROWSER_RECORDER@LOCAL_RECORD",LOCAL_COUNT:"PARSONAL_BROWSER_RECORDER@LOCAL_COUNT",RECORD_HISTORY:"PARSONAL_BROWSER_RECORDER@RECORD_HISTORY",COUNT_HISTORY:"PARSONAL_BROWSER_RECORDER@COUNT_HISTORY",LOCAL_RECORD_TMP:"PARSONAL_BROWSER_RECORDER@LOCAL_RECORD_TMP",LOCAL_COUNT_TMP:"PARSONAL_BROWSER_RECORDER@LOCAL_COUNT_TMP",THEME:"PARSONAL_BROWSER_RECORDER@THEME",OPENID_CONNECT_SERVICE_CODE:"PARSONAL_BROWSER_RECORDER@OPENID_CONNECT_SERVICE_CODE"};var isLocalStorageAvailable=window.localStorage?true:false;function _getDataByKey(key){if(!isLocalStorageAvailable){return null}var data=window.localStorage.getItem(key);if(!data){return null}else{return JSON.parse(data)}}function _removeDataByKey(key){if(!isLocalStorageAvailable){return true}try{window.localStorage.removeItem(key);return true}catch(e){return false}}function _saveDataByKey(key,data){if(!isLocalStorageAvailable){return true}try{window.localStorage.setItem(key,JSON.stringify(data));return true}catch(e){return false}}function Storage(){this.suffix=""}Storage.prototype.isLocalStorageAvailable=function(){return isLocalStorageAvailable};Storage.prototype.setSuffix=function(suffix){this.suffix=suffix};Storage.prototype.getKeyWithSuffix=function(key,suffix){if(!suffix){suffix=this.suffix}if(!suffix){return key}return key+"_"+suffix};Storage.prototype.getEnvironment=function(){return _getDataByKey(keys.ENVIRONMENT)};Storage.prototype.saveEnvironment=function(environment){return _saveDataByKey(keys.ENVIRONMENT,environment)};Storage.prototype.removeEnvironment=function(){return _removeDataByKey(keys.ENVIRONMENT)};Storage.prototype.getSetting=function(){return _getDataByKey(keys.SETTING)};Storage.prototype.hasSetting=function(){return !!this.getSetting()};Storage.prototype.saveSetting=function(setting){return _saveDataByKey(keys.SETTING,setting)};Storage.prototype.removeSetting=function(){return _removeDataByKey(keys.SETTING)};Storage.prototype.getAnnounceMessage=function(){return _getDataByKey(keys.ANNOUNCE)};Storage.prototype.saveAnnounceMessage=function(announce){return _saveDataByKey(keys.ANNOUNCE,announce)};Storage.prototype.removeAnnounceMessage=function(){return _removeDataByKey(keys.ANNOUNCE)};Storage.prototype.getAdminMessage=function(){return _getDataByKey(keys.ADMIN_MESSAGE)};Storage.prototype.saveAdminMessage=function(admin){return _saveDataByKey(keys.ADMIN_MESSAGE,admin)};Storage.prototype.removeAdminMessage=function(){return _removeDataByKey(keys.ADMIN_MESSAGE)};Storage.prototype.getLocalRecord=function(suffix){return _getDataByKey(this.getKeyWithSuffix(keys.LOCAL_RECORD,suffix))};Storage.prototype.hasLocalRecord=function(suffix){var localRecords=this.getLocalRecord(suffix);return localRecords&&localRecords.length>0};Storage.prototype.saveLocalRecord=function(localRecordArray,suffix){return _saveDataByKey(this.getKeyWithSuffix(keys.LOCAL_RECORD,suffix),localRecordArray)};Storage.prototype.addLocalRecord=function(localRecord,suffix){if(!localRecord){return true}var localRecords=this.getLocalRecord(suffix);if(!localRecords){localRecords=[]}localRecords.push(localRecord);return _saveDataByKey(this.getKeyWithSuffix(keys.LOCAL_RECORD,suffix),localRecords)};Storage.prototype.removeLocalRecord=function(suffix){return _removeDataByKey(this.getKeyWithSuffix(keys.LOCAL_RECORD,suffix))};Storage.prototype.getLocalCount=function(suffix){return _getDataByKey(this.getKeyWithSuffix(keys.LOCAL_COUNT,suffix))};Storage.prototype.hasLocalCount=function(suffix){var localCounts=this.getLocalCount(suffix);return localCounts&&localCounts.length>0};Storage.prototype.saveLocalCount=function(localCountArray,suffix){return _saveDataByKey(this.getKeyWithSuffix(keys.LOCAL_COUNT,suffix),localCountArray)};Storage.prototype.addLocalCount=function(localCount,suffix){if(!localCount){return true}var localCounts=this.getLocalCount(suffix);if(!localCounts){localCounts=[]}localCounts.push(localCount);return _saveDataByKey(this.getKeyWithSuffix(keys.LOCAL_COUNT,suffix),localCounts)};Storage.prototype.removeLocalCount=function(suffix){return _removeDataByKey(this.getKeyWithSuffix(keys.LOCAL_COUNT,suffix))};Storage.prototype.getRecordHistory=function(suffix){return _getDataByKey(this.getKeyWithSuffix(keys.RECORD_HISTORY,suffix))};Storage.prototype.addRecordHistory=function(history,suffix){if(!history){return true}var historys=this.getRecordHistory(suffix);if(!historys){historys=[]}historys.unshift(history);if(historys.length>100){historys.length=100}return _saveDataByKey(this.getKeyWithSuffix(keys.RECORD_HISTORY,suffix),historys)};Storage.prototype.getCountHistory=function(suffix){return _getDataByKey(this.getKeyWithSuffix(keys.COUNT_HISTORY,suffix))};Storage.prototype.addCountHistory=function(history,suffix){if(!history){return true}var historys=this.getCountHistory(suffix);if(!historys){historys=[]}historys.unshift(history);if(historys.length>100){historys.length=100}return _saveDataByKey(this.getKeyWithSuffix(keys.COUNT_HISTORY,suffix),historys)};Storage.prototype.getLocalTmp=function(type,suffix){if(type==="record"){return _getDataByKey(this.getKeyWithSuffix(keys.LOCAL_RECORD_TMP,suffix))}else{return _getDataByKey(this.getKeyWithSuffix(keys.LOCAL_COUNT_TMP,suffix))}};Storage.prototype.addLocalTmp=function(data,type,suffix){var array=this.getLocalTmp(type,suffix);if(!array){array=[]}array.push(data);if(type==="record"){return _saveDataByKey(this.getKeyWithSuffix(keys.LOCAL_RECORD_TMP,suffix),array)}else{return _saveDataByKey(this.getKeyWithSuffix(keys.LOCAL_COUNT_TMP,suffix),array)}};Storage.prototype.removeLocalTmp=function(type,suffix){if(type==="record"){return _removeDataByKey(this.getKeyWithSuffix(keys.LOCAL_RECORD_TMP,suffix))}else{return _removeDataByKey(this.getKeyWithSuffix(keys.LOCAL_COUNT_TMP,suffix))}};Storage.prototype.getTheme=function(){var theme=_getDataByKey(keys.THEME);if(!theme){return null}else{return Number(theme.theme)}};Storage.prototype.saveTheme=function(theme){return _saveDataByKey(keys.THEME,{theme:theme})};Storage.prototype.removeTheme=function(){return _removeDataByKey(keys.THEME)};Storage.prototype.getOpenidConnectServiceCode=function(){const openidConnectServiceCode=_getDataByKey(keys.OPENID_CONNECT_SERVICE_CODE);if(!openidConnectServiceCode){return null}else{return openidConnectServiceCode.oidcServiceCode}};Storage.prototype.hasOpenidConnectServiceCode=function(){return !!this.getOpenidConnectServiceCode()};Storage.prototype.saveOpenidConnectServiceCode=function(oidcServiceCode){return _saveDataByKey(keys.OPENID_CONNECT_SERVICE_CODE,{oidcServiceCode:oidcServiceCode})};Storage.prototype.removeOpenidConnectServiceCode=function(){return _removeDataByKey(keys.OPENID_CONNECT_SERVICE_CODE)};Storage.prototype.getAllSavedData=function(){var datas={};for(var i=0,l=localStorage.length;i<l;i++){var key=localStorage.key(i);if(_isTargetKey(key)){datas[key]=_getDataByKey(key)||""}}return datas;function _isTargetKey(key){for(var saveKey in keys){if(key.indexOf(keys[saveKey])==0){return true}}return false}};Storage.prototype.getAllSavedSuffix=function(){var array=[];for(var i=0,l=localStorage.length;i<l;i++){var key=localStorage.key(i);if(!_isTargetKey(key)){continue}var suffix=key.split("_").pop();if($.inArray(suffix,array)<0){array.push(suffix)}}return array;function _isTargetKey(key){if(key.indexOf(keys.LOCAL_RECORD)==0||key.indexOf(keys.LOCAL_COUNT)==0||key.indexOf(keys.LOCAL_RECORD_TMP)==0||key.indexOf(keys.LOCAL_COUNT_TMP)==0||key.indexOf(keys.RECORD_HISTORY)==0||key.indexOf(keys.COUNT_HISTORY)==0){return true}return false}};Recorder=Recorder||{};Recorder.storage=new Storage()})(jQuery);(function($){function Notification(){this.cache={wrapper:null,content:null}}Notification.prototype.showMessage=function(message){var _this=this;if(!this.cache.wrapper){this.cache.wrapper=$("#notification_wrapper");this.cache.content=$("#notification_content")}this.cache.content.removeClass("text-x-large").removeClass("text-large").removeClass("text-middle").removeClass("text-small").removeClass("text-x-small");if(message.length<=8){this.cache.content.addClass("text-x-large")}else{if(message.length<=16){this.cache.content.addClass("text-large")}else{this.cache.content.addClass("text-middle")}}this.cache.content.text("");this.cache.content.text(message);this.cache.wrapper.fadeIn("slow",function(){setTimeout(function(){_this.cache.wrapper.fadeOut("slow")},2500)})};Notification.prototype.forceHide=function(){if(!this.cache.wrapper){this.cache.wrapper=$("#notification_wrapper");this.cache.content=$("#notification_content")}this.cache.wrapper.hide()};Recorder=Recorder||{};Recorder.notification=new Notification()})(jQuery);(function(){function Factory(){}Factory.prototype.createRecordHistory=function(id,name,timerecorderId){var recordTimeStamp=Recorder.watch.getWatchDate();if(!recordTimeStamp){recordTimeStamp=new Date()}return{status:Recorder.Consts.HistoryStatus.NONE,name:name,id:id,latitude:null,longitude:null,send_timestamp:null,highAcPos:null,lowAcPos:null,highAccuracyFlg:false,record_timestamp:Recorder.utility.getFullDateString(recordTimeStamp),credential_code:Recorder.Consts.CredentialCode.CLICK,record_image:null,error_code:null,image_result:Recorder.Consts.ImageResult.NONE,user_token:Recorder.userData.user.user_token,timerecorder_id:timerecorderId}};Factory.prototype.recordHistoryToRecordData=function(historyData,isLocal){var recordData={id:historyData.id,latitude:historyData.latitude,longitude:historyData.longitude,highAcPos:historyData.highAcPos,lowAcPos:historyData.lowAcPos,highAccuracyFlg:historyData.highAccuracyFlg,credential_code:historyData.credential_code,record_image:historyData.record_image,user_token:historyData.user_token,timerecorder_id:historyData.timerecorder_id};if(isLocal){recordData.record_timestamp=historyData.record_timestamp}recordData.unique_timestamp=historyData.record_timestamp;if(historyData.input_hash){recordData.input_hash=historyData.input_hash}recordData.version=Recorder.Consts.VERSION;return recordData};Factory.prototype.createCountHistory=function(id,name){var recordTimeStamp=Recorder.watch.getWatchDate();if(!recordTimeStamp){recordTimeStamp=new Date()}return{status:Recorder.Consts.HistoryStatus.NONE,name:name,id:id,amount:null,send_timestamp:null,record_timestamp:Recorder.utility.getFullDateString(recordTimeStamp),credential_code:Recorder.Consts.CredentialCode.CLICK,error_code:null,user_token:Recorder.userData.user.user_token}};Factory.prototype.countHistoryToCountData=function(historyData,isLocal){var countData={id:historyData.id,amount:historyData.amount,user_token:historyData.user_token};if(isLocal){countData.record_timestamp=historyData.record_timestamp}return countData};Factory.prototype.createSystemAnnounceData=function(baseAnnounceMessage){var systemAnnounceMessage={title:baseAnnounceMessage.title||"",day:baseAnnounceMessage.day||"",time:baseAnnounceMessage.time||"",link_url:baseAnnounceMessage.link_url||"",link_title:baseAnnounceMessage.link_title||""};systemAnnounceMessage.already_show=false;return systemAnnounceMessage};Factory.prototype.createAdminAnnounceData=function(baseAdminMessage){var adminAnnounceMessage={content:baseAdminMessage.content||""};adminAnnounceMessage.already_show=false;return adminAnnounceMessage};Recorder=Recorder||{};Recorder.factory=new Factory()})();(function(){Recorder=Recorder||{};var userAgent=window.navigator.userAgent.toLocaleLowerCase();var isAccessable=true;if(userAgent.indexOf("msie")!=-1){if(userAgent.indexOf("msie 5.")!=-1||userAgent.indexOf("msie 6.")!=-1||userAgent.indexOf("msie 7.")!=-1||userAgent.indexOf("msie 8.")!=-1||userAgent.indexOf("msie 9.")!=-1){isAccessable=false}}var isMobile=false;if(userAgent.indexOf("android")!=-1||userAgent.indexOf("iphone")!=-1){if(userAgent.indexOf("mobile")!=-1){isMobile=true}}var isTablet=false;if((userAgent.indexOf("android")!=-1&&!isMobile)||userAgent.indexOf("ipad")!=-1){isTablet=true}var isOldAndroid=false;if(userAgent.indexOf("android 1.5")!=-1||userAgent.indexOf("android 1.6")!=-1||userAgent.indexOf("android 2.1")!=-1||userAgent.indexOf("android 2.2")!=-1||userAgent.indexOf("android 2.3")!=-1){if(userAgent.indexOf("mobile safari")!=-1){isOldAndroid=true}}var utility={};utility.isAccessable=function(){return isAccessable};utility.isMobile=function(){return isMobile};utility.isTablet=function(){return isTablet};utility.isOldAndroid=function(){return isOldAndroid};utility.isNumeric=function(value){if(!value){return false}if(isNaN(Number(value))){return false}return true};utility.stringFormat=function(baseString,array){if(!array){return baseString}for(var i=0,l=array.length;i<l;i++){baseString=baseString.replace(/%s/,array[i])}return baseString};utility.getFullDateString=function(date){var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var hour=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();return""+year+_padFrontZero(month)+_padFrontZero(day)+_padFrontZero(hour)+_padFrontZero(minute)+_padFrontZero(second)};utility.getHourToSecondString=function(date){var hour=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();return""+_padFrontZero(hour)+":"+_padFrontZero(minute)+":"+_padFrontZero(second)};utility.getDateForLog=function(dateString){return dateString?dateString.substr(4,2)+"/"+dateString.substr(6,2):""};utility.getTimeForLog=function(dateString){return dateString?dateString.substr(8,2)+":"+dateString.substr(10,2):""};utility.isEmptyArray=function(array){return !array||array.length==0};utility.alertWithCallback=function(message,callback,params){alert(message);if(callback){if(params){callback(params)}else{callback()}}Recorder.watch.refreshWatch()};utility.confirmWithCallback=function(message,okCallback,noCallback,okParams,noParams){if(window.confirm(message)){if(okCallback){if(okParams){okCallback(okParams)}else{okCallback()}}}else{if(noCallback){if(noParams){noCallback(noParams)}else{noCallback()}}}Recorder.watch.refreshWatch()};utility.isInternetExplorer=function(){var ua=navigator.userAgent.toLowerCase();var ver=navigator.appVersion.toLowerCase();var isMSIE=(ua.indexOf("msie")>-1)&&(ua.indexOf("opera")==-1);var isIE11=(ua.indexOf("trident/7")>-1);var isIE=isMSIE||isIE11;return isIE};utility.getUrlParam=function(key){const pageUrl=window.location.search.substring(1);const urlVar=pageUrl.split("&");for(let i=0;i<urlVar.length;i++){let paramName=urlVar[i].split("=");if(paramName[0]===key){return decodeURI(paramName[1])}}};Recorder.utility=utility;function _padFrontZero(value){if(value<10){return"0"+value}return""+value}})();(function($){var baseUrl=location.protocol+"//"+location.host;function Network(){}Network.prototype.initAjaxSetting=function(){jQuery.ajaxSetup({timeout:60000});$.ajaxPrefilter(function(options,orgOptions,xhr){orgOptions.data=orgOptions.data||{};for(var key in orgOptions.data){if(orgOptions.data.hasOwnProperty(key)){if(orgOptions.data[key]==null||orgOptions.data[key]===undefined||orgOptions.data[key]==="null"||orgOptions.data[key]==="undefined"){orgOptions.data[key]=""}}}options.data=$.param($.extend(orgOptions.data||{},{d_param:new Date().getTime()}))})};Network.prototype.getBaseUrl=function(){return baseUrl};Network.prototype.isHttps=function(){if(location.hostname==="127.0.0.1"||location.hostname.indexOf("10.0.0.")===0||location.hostname==="localhost"){return true}return location.protocol==="https:"};Network.prototype.isOnLine=function(){return window.navigator.onLine};Network.prototype.connectServer=function(datas,connectSuccessCallBack,connectErrorCallBack,gatewayUrl){datas.sendData.version=Recorder.Consts.VERSION;if(!datas.hasOwnProperty("processData")){datas.processData=datas.sendData}if(!Recorder.network.isOnLine()){connectErrorCallBack({status:Recorder.Consts.ErrorCode.XHR_STATUS_OFFLINE},"RecorderIsOffLine",null,datas.processData);return}$.ajax({url:baseUrl+gatewayUrl,type:"post",data:datas.sendData,dataType:"json"}).done(function(data,status,xhr){connectSuccessCallBack(data,status,xhr,datas.processData)}).fail(function(xhr,status,errorThrown){connectErrorCallBack(xhr,status,errorThrown,datas.processData)})};Network.prototype.isNeedSaveStatusByError=function(statusCode,statusText){if(statusText==="timeout"||statusText==="RecorderIsOffLine"||statusText==="parsererror"){return true}else{if(statusText==="error"){if(statusCode===0||statusCode===404||statusCode===407||statusCode===408||statusCode===500||statusCode===503||statusCode===504){return true}}}return false};Recorder=Recorder||{};Recorder.network=new Network()})(jQuery);(function($){Recorder=Recorder||{};function Modal(){this.blocking=false;this.closable=false;this.nowShowing=false;this.useMedia=false;this.cache={wrapper:null,back:null,window:null}}Modal.prototype.blocked=function(){if(this.blocking){return true}this.blocking=true;return false};Modal.prototype.unBlock=function(){this.blocking=false};Modal.prototype.init=function(isOldAndroid){var _this=this;this.cache.wrapper=$("#modal_wrapper");this.cache.back=$("#modal_back");this.cache.window=$("#modal_window");if(isOldAndroid){$(this.cache.wrapper).addClass("modal-wrapper-absolute")}else{$(this.cache.wrapper).addClass("modal-wrapper")}$(this.cache.back).bind({click:function(){if(_this.closable){_this.hide()}},touchstart:function(){if(_this.closable){_this.hide()}}})};Modal.prototype.addCloseButton=function(className){var _this=this;var closeButton=$("<A>").attr("href","#").addClass("close-icon").addClass(className);$(closeButton).click(function(){_this.hide()});$(this.cache.window).append(closeButton);this.closable=true};Modal.prototype.addCloseButtonOuter=function(){this.addCloseButton("close-icon-outer")};Modal.prototype.addCloseButtonInner=function(){this.addCloseButton("close-icon-inner")};Modal.prototype.showCountInput=function(callback,data){var _this=this;this.hideWindow(true);var container=$("<DIV>").addClass("container");var title=$("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("029"));var password=$("<DIV>").addClass("item-wrapper").append($("<INPUT>").attr("type","text").attr("id","input_count").attr("ime-mode","disabled").addClass("input-text"));var button=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("038"),null);button.addClass("align-right");$(button).click(function(){if(_this.blocked()){return}var count=$("#input_count").val();if(count===""){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("029"),null,null);_this.unBlock();return}if(!Recorder.utility.isNumeric(count)||!/^[0-9]+\.?[0-9]*$/.test(count)){alert(Recorder.i18N.getMessage("030"));_this.unBlock();return}if(count==="0"||count==="0.0"){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("031"),null,null);_this.unBlock();return}var isMinus=false;var isFloat=false;if(count.indexOf("-")==0){isMinus=true}if(count.indexOf(".")>0){isFloat=true}if((!isMinus&&!isFloat&&count.length>8)||(isMinus&&!isFloat&&count.length>9)||(!isMinus&&isFloat&&count.length>9)||(isMinus&&isFloat&&count.length>10)){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("032"),null,null);_this.unBlock();return}callback(data,count)});this.addCloseButtonOuter();container.append(title).append(password).append(button);$(this.cache.window).addClass("modal-window-oneline-input");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Modal.prototype.showPassword=function(callback,data){var _this=this;this.hideWindow(true);var container=$("<DIV>").addClass("container");var title=$("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("033"));var password=$("<DIV>").addClass("item-wrapper").append($("<INPUT>").attr("type","password").attr("id","password").attr("ime-mode","disabled").addClass("input-text"));var button=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("038"),null);button.addClass("align-right");$(button).click(function(){if(_this.blocked()){return}var input=$("#password").val();if(input===""){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("033"),null,null);_this.unBlock();return}var hash=asmCrypto.PBKDF2_HMAC_SHA256.hex(input,Recorder.userData.user.password.s,Number(Recorder.userData.user.password.i),Number(Recorder.userData.user.password.l));data.input_hash=asmCrypto.PBKDF2_HMAC_SHA256.hex(hash,data.record_timestamp,3,Number(Recorder.userData.user.password.l)).toString();if(hash.toString().lastIndexOf(Recorder.userData.user.password.v,0)!==0){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("034"),null,null);_this.unBlock();return}callback(data)});this.addCloseButtonOuter();container.append(title).append(password).append(button);$(this.cache.window).addClass("modal-window-oneline-input");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Modal.prototype.showAccount=function(closable,callback,orgId,orgPass){var _this=this;this.hideWindow(false);var container=$("<DIV>").addClass("container");var title=$("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("035"));var id=$("<DIV>").addClass("item-wrapper").append($("<DIV>").addClass("item-title").addClass("text-middle").addClass("text-bold").text(Recorder.i18N.getMessage("036"))).append($("<INPUT>").attr("type","text").attr("id","id").attr("ime-mode","disabled").addClass("input-text"));var password=$("<DIV>").addClass("item-wrapper").append($("<DIV>").addClass("item-title").addClass("text-middle").addClass("text-bold").text(Recorder.i18N.getMessage("037"))).append($("<INPUT>").attr("type","password").attr("id","password").attr("ime-mode","disabled").addClass("input-text"));var button=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("038"),null);button.addClass("align-right");$(button).click(function(){if(_this.blocked()){return}var id=$("#id").val();var password=$("#password").val();if(!id||!password){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("035"),null,null);_this.unBlock();return}callback(id,password)});if(closable){this.addCloseButtonOuter()}if(orgId){$("#id",id).val(orgId)}if(orgPass){$("#password",password).val(orgPass)}const anchorForSaml=$("<div>").append($("<a>").attr("href","dummy").text(Recorder.i18N.getMessage("099"))).css({"padding-top":"2rem","padding-left":"2rem","text-align":"left"}).click(function(e){e.preventDefault();Recorder.modal.showSamlLogin1(_this)});container.append(title).append(id).append(password).append(button);Recorder.modal.samlEnabled()&&container.append(anchorForSaml);$(this.cache.window).addClass("modal-window-account");const addOpenidConnecButtonCount=Recorder.modal.createOpenidConnectArea(container);Recorder.modal.modalWindowResize(addOpenidConnecButtonCount);$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Modal.prototype.samlEnabled=function(){var userAgent=window.navigator.userAgent.toUpperCase();if(userAgent.indexOf("MSIE")>=0||userAgent.indexOf("TRIDENT")>=0){return false}const url=new URL(window.location.href);const targetHosts=["s2.ta.kingoftime.jp","s3.ta.kingoftime.jp","s4.ta.kingoftime.jp","s5.ta.kingoftime.jp","s2.ta.stage-time.net","s3.ta.stage-time.net","ta.dev-time.net","localhost","127.0.0.1","kt.hataraku-ntt-east.jp","ntteast.ta.dev-time.net"];return targetHosts.some(function(e){return url.hostname===e})};Modal.prototype.showSamlLogin1=function(){const _this=this;this.hideWindow(false);const container=$('<div class="container">');const title=$('<p class="modal-title text-middle">'+Recorder.i18N.getMessage("100")+"</p>");const companyCode=$("<div>").addClass("item-wrapper").append($('<div class="item-title text-middle text-bold">'+Recorder.i18N.getMessage("101")+"</div>")).append($('<input type="text" id="company_code" ime-mode="disabled" class="input-text" maxlength="15">'));const button=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("038"),null);button.addClass("align-right").click(function(e){if(_this.blocked()){return}const companyCodeVal=$("#company_code").val().trim();if(companyCodeVal.length===0){alert(Recorder.i18N.getMessage("103"));_this.unBlock();return}_this.unBlock();Recorder.control.clickSamlLoginButton(companyCodeVal)});container.append(title).append(companyCode).append(button);$(this.cache.window).addClass("modal-window-account");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Modal.prototype.showSamlLogin2=function(idpSettings){const _this=this;this.hideWindow(false);const container=$('<div class="container">');const title=$('<p class="modal-title text-middle">'+Recorder.i18N.getMessage("104")+"</p>");const compareIdpName=function(a,b){if(a[1]===b[1]){return 0}return a[1]>b[1]?1:-1};const idpSettingsOption=Object.entries(idpSettings).sort(compareIdpName).map(function(e){return'<option value="'+e[0]+'">'+e[1]+"</option>"}).reduce(function(acc,item){return acc+item});const idpSettingsSelector=$("<div>").addClass("item-wrapper").append($('<div class="item-title text-middle text-bold">'+Recorder.i18N.getMessage("105")+"</div>")).append($('<select id="saml_settings_id" name="saml_settings_id">').append(idpSettingsOption).css({width:"90%",padding:"0.5rem",margin:"1rem"}));const button=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("038"),null);button.addClass("align-right").click(function(e){if(_this.blocked()){return}const samlSettingsIdVal=$("#saml_settings_id").val().trim();if(samlSettingsIdVal.length===0){alert(Recorder.i18N.getMessage("106"));_this.unBlock();return}_this.unBlock();Recorder.control.clickSamlSettingsSelectButton(samlSettingsIdVal,window.location)});container.append(title).append(idpSettingsSelector).append(button);$(this.cache.window).addClass("modal-window-account");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Modal.prototype.createOpenidConnectArea=function(container){let openidConnectArea=$("<DIV>").addClass("item-wrapper").css({display:"flex","flex-flow":"row","justify-content":"center"});let addOpenidConnectButtonCount=0;if(Recorder.modal.freeeOpenidConnectEnabled()){const freeeURL=window.location.protocol+"//"+window.location.host+"/oidc/start?oidc_service_code=1&oidc_execute_code=1&is_my_recorder=1";const freeeName="freee_authenticity_token";const freeeValue="freee_login";const freeeCompanyStyle="btn-openid-connect-freee-login";const freeeImagePath="freee_login_button.png";Recorder.view.addOpenidConnectButtonForModal(openidConnectArea,freeeURL,freeeName,freeeValue,freeeCompanyStyle,freeeImagePath);addOpenidConnectButtonCount++}container.append(openidConnectArea);return addOpenidConnectButtonCount};Modal.prototype.freeeOpenidConnectEnabled=function(){const userAgent=window.navigator.userAgent.toUpperCase();if(userAgent.indexOf("MSIE")>=0||userAgent.indexOf("TRIDENT")>=0){return false}const url=new URL(window.location.href);const targetHosts=["kintaiplus.freee.co.jp","freee.ta.dev-time.net","localhost","127.0.0.1"];return targetHosts.some(function(e){return url.hostname===e})};Modal.prototype.showTwoFactorAuthenticationForm=function(closable,callback,orgId,orgPass){var _this=this;this.hideWindow(false);var container=$("<DIV>").addClass("container");var title=$("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("118"));var code=$("<DIV>").addClass("item-wrapper").append($("<DIV>").addClass("item-title").addClass("text-middle").addClass("text-bold").text(Recorder.i18N.getMessage("117"))).append($("<INPUT>").attr("type","text").attr("id","two_factor_authentication_code").attr("ime-mode","disabled").attr("required",true).addClass("input-text"));var button=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("038"),null);button.addClass("align-right");$(button).click(function(){if(_this.blocked()){return}var code=$("#two_factor_authentication_code").val();if(!orgId||!orgPass){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("111"),null,null);Recorder.control.unBlock();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton);return}if(!code){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("118"),null,null);_this.unBlock();return}callback(orgId,orgPass,code)});if(closable){this.addCloseButtonOuter()}container.append(title).append(code).append(button);$(this.cache.window).addClass("modal-window-account");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Modal.prototype.modalWindowResize=function(addOpenidConnectButtonCount){let modalWindowAccount=$(".modal-window-account");const height=$(modalWindowAccount).css(["height"]).height;const minHeight=$(modalWindowAccount).css(["min-height"])["min-height"];const maxHeight=$(modalWindowAccount).css(["min-height"])["min-height"];const fontSize=getComputedStyle(document.documentElement).fontSize;const resizeHeight=(parseFloat(height)/parseFloat(fontSize)+2*addOpenidConnectButtonCount)+"rem";const resizeMaxHeight=(parseFloat(minHeight)/parseFloat(fontSize)+2*addOpenidConnectButtonCount)+"rem";const resizeMinHeight=(parseFloat(maxHeight)/parseFloat(fontSize)+2*addOpenidConnectButtonCount)+"rem";$(modalWindowAccount).css({height:resizeHeight,"max-height":resizeMaxHeight,"min-height":resizeMinHeight})};Modal.prototype.showUserSelectionWindow=function(accessKey,loginEnabledUsersSelectionList){const _this=this;this.hideWindow(false);let container=$("<DIV>").addClass("container");let userSelectionMain=$("<DIV>").addClass("user-selection-main").addClass("clearfix");const userSelectionTable=_createUserSelectionTable(accessKey,loginEnabledUsersSelectionList);$(userSelectionMain).append($(userSelectionTable));$(container).append($(userSelectionMain));$(this.cache.window).addClass("modal-window-user-selection");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show();function _createUserSelectionTable(accessKey,loginEnabledUsersSelectionList){let userSelectionMain=$("<TABLE>").addClass("user-selection").attr("cellpadding","0").attr("cellspacing","0").attr("border","1");let headerRow=$("<TR>");$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("112")).attr("width","15%"));$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("113")).attr("width","40%"));$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("114")).attr("width","20%"));$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("115")).attr("width","25%"));$(userSelectionMain).append($("<THEAD>").append($(headerRow)));function _createLoginButton(accessKey,selectionParam){let loginButton=$('<button type="button">').text(Recorder.i18N.getMessage("115"));$(loginButton).click(function(){Recorder.control.unBlock();Recorder.control.verifyRequestOpenidConnectAccount(accessKey,selectionParam);$(_this.cache.window).removeClass("modal-window-user-selection")});return $("<TD>").append($("<p>").append($(loginButton)))}let body=$("<TBODY>");loginEnabledUsersSelectionList.forEach(function(loginEnabledUsersSelection){let bodyRow=$("<TR>");$(bodyRow).append($("<TD>").text(loginEnabledUsersSelection.companyCode).attr("width","15%"));$(bodyRow).append($("<TD>").text(loginEnabledUsersSelection.userName).attr("width","40%"));$(bodyRow).append($("<TD>").text(loginEnabledUsersSelection.uerRoleName).attr("width","20%"));let buttonRow=_createLoginButton(accessKey,loginEnabledUsersSelection.selectionParam);$(bodyRow).append($(buttonRow).attr("width","25%"));$(body).append($(bodyRow))});$(userSelectionMain).append($(body));return $("<DIV>").addClass("user-selection-content").addClass("scroll-y-only").append($(userSelectionMain))}};Modal.prototype.showHistory=function(recordHistoryArray,countHistoryArray){this.hideWindow(true);var container=$("<DIV>").addClass("container");var historyMain=$("<DIV>").addClass("history-main").addClass("clearfix");var tabGroup=$("<UL>").addClass("history-tab-group");$(tabGroup).append($("<LI>").addClass("history-tab").addClass("history-tab-active").text(Recorder.i18N.getMessage("013"))).append(_createHistoryContent(recordHistoryArray,false));if(Recorder.userData.timerecorder.use_count_flag==="1"&&!Recorder.utility.isEmptyArray(Recorder.userData.timerecorder.count_button)){$(tabGroup).append($("<LI>").addClass("history-tab").text(Recorder.i18N.getMessage("008"))).append(_createHistoryContent(countHistoryArray,true).css("display","none"))}$(".history-tab",$(tabGroup)).each(function(){if($(this).attr("class").indexOf("history-tab-active")===-1){$(this).next().hide()}$(this).hover(function(){$(this).addClass("history-tab-hover")},function(){$(this).removeClass("history-tab-hover")});$(this).click(function(){$(".history-tab",$(tabGroup)).removeClass("history-tab-active");$(this).addClass("history-tab-active");$(".history-tab",$(tabGroup)).each(function(){if($(this).attr("class").indexOf("history-tab-active")===-1){$(this).next().fadeOut("fast")}});$(this).next().fadeIn("fast")})});$(historyMain).append($(tabGroup));$(container).append($(historyMain));this.addCloseButtonOuter();$(this.cache.window).addClass("modal-window-history");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show();function _createHistoryContent(array,isCount){var historyMain=$("<TABLE>").addClass("historys").attr("cellpadding","0").attr("cellspacing","0").attr("border","1");var headerRow=$("<TR>");$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("039")));$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("040")));$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("041")));if(isCount){$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("042")))}$(headerRow).append($("<TH>").text(Recorder.i18N.getMessage("043")));$(historyMain).append($(headerRow));if(!Recorder.utility.isEmptyArray(array)){for(var i=0,l=array.length;i<l;i++){var historyData=array[i];var row=$("<TR>");$(row).append($("<TD>").append($("<DIV>").addClass("history-timestamp-text").text(Recorder.utility.getDateForLog(historyData.send_timestamp))).append($("<DIV>").addClass("history-timestamp-text").text(Recorder.utility.getTimeForLog(historyData.send_timestamp))));$(row).append($("<TD>").append($("<DIV>").addClass("history-timestamp-text").text(Recorder.utility.getDateForLog(historyData.record_timestamp))).append($("<DIV>").addClass("history-timestamp-text").text(Recorder.utility.getTimeForLog(historyData.record_timestamp))));$(row).append($("<TD>").text(historyData.name));if(isCount){$(row).append($("<TD>").text(""+historyData.amount))}$(row).append($("<TD>").text(Recorder.i18N.getHistoryStatusMessage(historyData.status)));$(historyMain).append($(row))}}return $("<DIV>").addClass("history-content").addClass("scroll-y-only").append($(historyMain))}};Modal.prototype.showAnnounceMessageModal=function(announceMessage,adminMessage){this.hideWindow(true);var container=$("<DIV>").addClass("container");var announceMessageMain=$("<DIV>").addClass("announce-message-main");announceMessageMain.append($("<DIV>").addClass("announce-message-section-title").addClass("text-large").addClass("text-bold").text(Recorder.i18N.getMessage("065")));if(announceMessage.length===0){announceMessageMain.append($("<DIV>").addClass("text-middle").addClass("text-bold").text(Recorder.i18N.getMessage("064"))).append($("<br>")).append($("<HR>"))}else{if(announceMessage.length>0){for(var i=0,l=announceMessage.length;i<l;i++){var systemMessage=announceMessage[i];var systemMessageContent=$("<DIV>").addClass("system-announce-content");if(systemMessage.title){systemMessageContent.append($("<DIV>").addClass("text-middle").addClass("text-bold").text(systemMessage.title))}if(systemMessage.day||systemMessage.time){systemMessageContent.append($("<DIV>").addClass("text-middle").text(systemMessage.day+" "+systemMessage.time))}if(systemMessage.link_title){systemMessageContent.append($("<DIV>").append($("<A>").attr("href",systemMessage.link_url).text(systemMessage.link_title)))}announceMessageMain.append($(systemMessageContent)).append($("<HR>"))}}}var adminMessageMain=$("<DIV>").addClass("announce-message-main");adminMessageMain.append($("<DIV>").addClass("announce-message-section-title").addClass("text-large").addClass("text-bold").text(Recorder.i18N.getMessage("097")));if(adminMessage.length===0){adminMessageMain.append($("<DIV>").addClass("text-middle").addClass("text-bold").text(Recorder.i18N.getMessage("064")))}else{if(adminMessage.length>=0){for(var i=0,l=adminMessage.length;i<l;i++){var message=adminMessage[i];var messageContent=$("<DIV>").addClass("system-announce-content");if(message.content){messageContent.append($("<DIV>").append("text-middle").html(message.content))}adminMessageMain.append($(messageContent)).append($("<HR>"))}}}$(container).append($(announceMessageMain));$(container).append($(adminMessageMain));this.addCloseButtonInner();$(this.cache.window).addClass("modal-window-announce-message").addClass("scroll-y-only");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Modal.prototype.showCamera=function(callback,data,needPassword){var _this=this;_this.useMedia=true;var _imageData="";var _sendButtonDefaultMessage=Recorder.i18N.getMessage("083");var _cameraUse=false;this.hideWindow(true);var container=$("<DIV>").addClass("container");if(!Recorder.useMedia.mediaUsable()){container.append($("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("084")))}else{if(Recorder.useMedia.userMediaApiUseable()){_cameraUse=true;container.append($("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("085")));container.append($("<DIV>").attr("id","camera_area"))}else{_cameraUse=true;_sendButtonDefaultMessage=Recorder.i18N.getMessage("086");container.append($("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("087")));container.append($("<DIV>").attr("id","camera_area"))}}if(needPassword){var passwordTitle=$("<P>").addClass("modal-title").addClass("text-middle").text(Recorder.i18N.getMessage("033"));var password=$("<DIV>").addClass("item-wrapper").append($("<INPUT>").attr("type","password").attr("id","password").attr("ime-mode","disabled").addClass("input-text"));container.append(passwordTitle).append(password)}var sendButtonClasses={outer:{normalSize:"btn-control-outer-size-long",activeSize:"btn-control-outer-active-size-long"},inner:{normalSize:"btn-control-inner-size-long",activeSize:"btn-control-inner-active-size-long"},message:"send-button-message"};var sendButton=Recorder.view.createControlButtonForModal(_sendButtonDefaultMessage,sendButtonClasses);sendButton.addClass("align-right");$(sendButton).click(function(){if(_this.blocked()){return}if(needPassword){var input=$("#password").val();if(input===""){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("033"),null,null);_this.unBlock();return}var hash=asmCrypto.PBKDF2_HMAC_SHA256.hex(input,Recorder.userData.user.password.s,Number(Recorder.userData.user.password.i),Number(Recorder.userData.user.password.l));data.input_hash=asmCrypto.PBKDF2_HMAC_SHA256.hex(hash,data.record_timestamp,3,Number(Recorder.userData.user.password.l)).toString();if(hash.toString().lastIndexOf(Recorder.userData.user.password.v,0)!==0){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("034"),null,null);_this.unBlock();return}}data.record_image=_imageData;callback(data)});this.addCloseButtonOuter();container.append(sendButton);$(this.cache.window).addClass("modal-window-camera");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show();if(_cameraUse){setTimeout(function(){Recorder.useMedia.initMediaArea(function(imageData){_imageData=imageData;var buttonMessage=sendButton.find("."+sendButtonClasses.message);if(!_imageData){buttonMessage.text(_sendButtonDefaultMessage)}else{buttonMessage.text(Recorder.i18N.getMessage("088"))}},"camera_area")},200)}};Modal.prototype.showLoading=function(){this.hideWindow(true);this.closable=false;var container=$("<DIV>").addClass("container");var loading=$("<DIV>").addClass("loading").append($("<DIV>").addClass("loading-part1")).append($("<DIV>").addClass("loading-part2")).append($("<DIV>").addClass("loading-part3")).append($("<DIV>").addClass("loading-part4")).append($("<DIV>").addClass("loading-part5")).append($("<DIV>").addClass("loading-part6")).append($("<DIV>").addClass("loading-part7")).append($("<DIV>").addClass("loading-part8"));$(container).append(loading);$(this.cache.window).css({height:"","max-height":"","min-height":""});$(this.cache.window).append($(container));$(this.cache.window).addClass("modal-window-loading");if(!this.nowShowing){this.show()}else{this.showWindow()}};Modal.prototype.hideWindow=function(needFadeOut){if(needFadeOut){this.cache.window.fadeOut("fast")}this.cache.window.html("");this.refreshWindowClass();this.unBlock()};Modal.prototype.showWindow=function(){this.cache.window.fadeIn("fast")};Modal.prototype.refreshWindowClass=function(){this.cache.window.removeClass("modal-window-account");this.cache.window.removeClass("modal-window-oneline-input");this.cache.window.removeClass("modal-window-history");this.cache.window.removeClass("modal-window-loading");this.cache.window.removeClass("modal-window-announce-message");this.cache.window.removeClass("modal-window-camera")};Modal.prototype.refresh=function(){this.closable=false;this.cache.window.html("");this.refreshWindowClass()};Modal.prototype.hide=function(){this.refresh();this.nowShowing=false;this.cache.wrapper.fadeOut("fast");this.unBlock();if(this.useMedia){Recorder.useMedia.destroy();this.useMedia=false}$(document.body).removeClass("no-vertical-scroll");$(document.body).unbind(".mainWindow");Recorder.control.unBlock()};Modal.prototype.show=function(){var _this=this;this.nowShowing=true;Recorder.notification.forceHide();this.cache.wrapper.fadeIn("fast",function(){_this.showWindow()});$(document.body).addClass("no-vertical-scroll");$(document.body).bind({"touchmove.mainWindow":function(event){if(!$(".scroll-y-only").has($(event.target).length)){event.preventDefault()}}})};Modal.prototype.showS3NecUserError=function(){this.hideWindow(true);var container=$("<DIV>").addClass("container");var title=$("<P>").addClass("modal-title").addClass("text-middle");var url=$("<DIV>").addClass("item-wrapper").html(Recorder.i18N.getMessage("097"));container.append(title).append(url);$(this.cache.window).addClass("modal-window-oneline-input");$(this.cache.window).append($("<DIV>").addClass("modal-content").addClass("clearfix").append($(container)));this.show()};Recorder.modal=new Modal()})(jQuery);(function(){function Announce(){}Announce.prototype.compareAnnounceMessageDataFromServer=function(dataFromServer){var savedAnnounceMessage=Recorder.storage.getAnnounceMessage();var savedAdminMessage=Recorder.storage.getAdminMessage();if(!savedAnnounceMessage||!savedAdminMessage){this.saveNewSystemAnnounceData(dataFromServer)}else{this.adjustSystemAnnounceMessage(savedAnnounceMessage,savedAdminMessage,dataFromServer)}};Announce.prototype.saveNewSystemAnnounceData=function(dataFromServer){var tmpAnnounceData=[];var tmpAdminData=[];if(dataFromServer.system.length>0){for(var i=0,l=dataFromServer.system.length;i<l;i++){tmpAnnounceData.push(Recorder.factory.createSystemAnnounceData(dataFromServer.system[i]))}}if(dataFromServer.admin_message.length>0){for(var i=0,l=dataFromServer.admin_message.length;i<l;i++){tmpAdminData.push(Recorder.factory.createAdminAnnounceData(dataFromServer.admin_message[i]))}}dataFromServer.system=tmpAnnounceData;dataFromServer.admin_message=tmpAdminData;Recorder.storage.saveAnnounceMessage(dataFromServer.system);Recorder.storage.saveAdminMessage(dataFromServer.admin_message)};Announce.prototype.adjustSystemAnnounceMessage=function(savedAnnounceMessage,savedAdminMessage,dataFromServer){var tmpAnnounceData=[];if(dataFromServer.system.length>0){for(var i=0,l=dataFromServer.system.length;i<l;i++){var announceMessage=Recorder.factory.createSystemAnnounceData(dataFromServer.system[i]);this.adjustSameSystemMessageStatus(savedAnnounceMessage,announceMessage);tmpAnnounceData.push(announceMessage)}}dataFromServer.system=tmpAnnounceData;Recorder.storage.saveAnnounceMessage(dataFromServer.system);var tmpAdminData=[];if(dataFromServer.admin_message.length>0){for(var i=0,l=dataFromServer.admin_message.length;i<l;i++){var adminMessage=Recorder.factory.createAdminAnnounceData(dataFromServer.admin_message[i]);this.adjustSameAdminMessageStatus(savedAdminMessage,adminMessage);tmpAdminData.push(adminMessage)}}dataFromServer.admin_message=tmpAdminData;Recorder.storage.saveAdminMessage(dataFromServer.admin_message)};Announce.prototype.adjustSameSystemMessageStatus=function(savedAnnounceMessages,systemAnnounceMessage){for(var i=0,l=savedAnnounceMessages.length;i<l;i++){var savedAnnounce=savedAnnounceMessages[i];if(savedAnnounce.title!==systemAnnounceMessage.title||savedAnnounce.day!==systemAnnounceMessage.day||savedAnnounce.time!==systemAnnounceMessage.time||savedAnnounce.link_url!==systemAnnounceMessage.link_url||savedAnnounce.link_title!==systemAnnounceMessage.link_title){continue}if(savedAnnounce.already_show){systemAnnounceMessage.already_show=true}}};Announce.prototype.adjustSameAdminMessageStatus=function(savedAdminMessages,systemAdminMessage){for(var i=0,l=savedAdminMessages.length;i<l;i++){var savedAdmin=savedAdminMessages[i];if(savedAdmin.content!==systemAdminMessage.content){continue}if(savedAdmin.already_show){systemAdminMessage.already_show=true}}};Announce.prototype.adjustAnnounceMessageBatch=function(){var notShowAnnounceCount=this.getNotShowAnnounceCount();if(notShowAnnounceCount==0){Recorder.view.hideAnnounceBatch()}else{if(notShowAnnounceCount>=10){notShowAnnounceCount="N"}Recorder.view.showAnnounceBatch(notShowAnnounceCount)}};Announce.prototype.getNotShowAnnounceCount=function(){var savedAnnounceMessage=Recorder.storage.getAnnounceMessage();var savedAdminMessage=Recorder.storage.getAdminMessage();var count=0;if(savedAnnounceMessage&&savedAnnounceMessage.length>0){for(var i=0,l=savedAnnounceMessage.length;i<l;i++){if(!savedAnnounceMessage[i].already_show){count++}}}if(savedAdminMessage&&savedAdminMessage.length>0){for(var i=0,l=savedAdminMessage.length;i<l;i++){if(!savedAdminMessage[i].already_show){count++}}}return count};Announce.prototype.showAnnounceMessage=function(){var savedAnnounceMessage=Recorder.storage.getAnnounceMessage();var savedAdminMessage=Recorder.storage.getAdminMessage();Recorder.modal.showAnnounceMessageModal(savedAnnounceMessage,savedAdminMessage);for(var i=0,l=savedAnnounceMessage.length;i<l;i++){savedAnnounceMessage[i].already_show=true}for(var i=0,l=savedAdminMessage.length;i<l;i++){savedAdminMessage[i].already_show=true}Recorder.storage.saveAnnounceMessage(savedAnnounceMessage);Recorder.storage.saveAdminMessage(savedAdminMessage);this.adjustAnnounceMessageBatch()};Recorder=Recorder||{};Recorder.announce=new Announce()})(jQuery);(function($){Recorder=Recorder||{};var map=null;var layerArray=new Array();function ViewControl(){this.buttonCount={record:0,count:0};this.cache={menuIcon:null,appIcon:null,logo:null,manifest:null,menuList:null,sectionName:null,employeeName:null,buttonList:null,locationArea:null,copyRignt:null,localRecordInfo:null,watchYearToDate:null,watchHourToSec:null,timerecorders:null,announceCount:null};this.currentTheme=0;this.themeChanging=true}ViewControl.prototype.init=function(isOldAndroid){var _this=this;this.cacheAll();if(isOldAndroid){$(this.cache.menuIcon).addClass("menu-icon-blur")}$(this.cache.menuIcon).click(function(){if($(_this.cache.menuList).css("display")==="none"){$(_this.cache.menuList).show()}else{$(_this.cache.menuList).hide()}});this.currentTheme=Recorder.storage.getTheme();if(!this.currentTheme){this.currentTheme=0}Recorder.view.changeTheme(this.currentTheme)};ViewControl.prototype.changeTheme=function(theme){$("#theme_style").attr("href","../personal/css/theme_"+theme+".css");this.themeChanging=false};ViewControl.prototype.toggleTheme=function(){if(this.themeChanging){return}this.themeChanging=true;if(this.currentTheme===0){this.currentTheme=1}else{this.currentTheme=0}Recorder.storage.saveTheme(this.currentTheme);Recorder.view.changeTheme(this.currentTheme)};ViewControl.prototype.resetTheme=function(){this.themeChanging=true;this.currentTheme=0;Recorder.view.changeTheme(this.currentTheme)};ViewControl.prototype.setButtonCount=function(recordNum,countNum){this.buttonCount.record=recordNum;this.buttonCount.count=countNum};ViewControl.prototype.cacheAll=function(){if(!this.cache.logo){this.cache.menuIcon=$("#menu_icon");this.cache.appIcon=$("#app_icon");this.cache.logo=$("#logo");this.cache.manifest=$("#manifest");this.cache.menuList=$("#menu");this.cache.sectionName=$("#section_name");this.cache.employeeName=$("#employee_name");this.cache.buttonList=$("#buttons");this.cache.locationArea=$("#location_area");this.cache.copyRignt=$("#copy_right");this.cache.localRecordInfo=$("#local_record_info");this.cache.timerecorders=$("#timerecorders");var watch=$("#watch");this.cache.watchYearToDate=watch.children(".watch-year-to-date").first();this.cache.watchHourToSec=watch.children(".watch-hour-to-sec").first();this.cache.locationInfo=$("#location_info");this.cache.locationInfoLow1=$("#location_info_low1");this.cache.locationInfoLow2=$("#location_info_low2");this.cache.locationInfoHigh1=$("#location_info_high1");this.cache.locationInfoHigh2=$("#location_info_high2")}};ViewControl.prototype.clearButtons=function(){this.cache.buttonList.html("")};ViewControl.prototype.clearAll=function(){this.clearButtons();this.cache.appIcon.attr("href","");this.cache.logo.attr("src","").hide();this.cache.manifest.attr("href","");this.cache.menuList.html("");this.cache.sectionName.text("");this.cache.employeeName.text("");this.cache.locationArea.html("");this.cache.copyRignt.text("");this.cache.localRecordInfo.text("");this.cache.watchYearToDate.text("");this.cache.watchHourToSec.text("");if(this.cache.announceCount){this.cache.announceCount.hide()}};ViewControl.prototype.clearMenu=function(){this.cache.menuList.html("")};ViewControl.prototype.addMenuItemForMessage=function(text,callback){Recorder.view.addMenuItemBase(text,callback,true)};ViewControl.prototype.addMenuItem=function(text,callback){Recorder.view.addMenuItemBase(text,callback,false)};ViewControl.prototype.addMenuItemBase=function(text,callback,forMessage){var _this=this;var item=$("<LI>").addClass("menu-item");var link=$("<A>").attr("href","#").addClass("text-middle").text(text);$(item).append(link);if(callback){$(item).click(function(e){$(_this.cache.menuList).hide();callback(this);e.preventDefault();e.stopPropagation()})}if(forMessage){link.append($("<SPAN>").addClass("announce-count").addClass("menu-list-announce-count").addClass("text-bold"))}this.cache.menuList.append(item)};ViewControl.prototype.addTimerecorderOption=function(timerecorder){var t=timerecorder;var MAX_LENGTH=10;var name=t.timerecorderName.length<=MAX_LENGTH?t.timerecorderName:t.timerecorderName.substring(0,MAX_LENGTH)+"...";var option=$("<option>").val(t.timerecorderId).text(t.sectionCode+" "+name).prop("selected",t.isSelected);this.cache.timerecorders.append(option)};ViewControl.prototype.addButton=function(text,id,addClass,mark,callback){var markFlag=mark?mark:"0";var buttonItem=$("<LI>");var buttonOuter=$("<DIV>").attr("id",id).addClass("record-btn-outer");var buttonInner=$("<DIV>").addClass("record-btn-inner");var buttonIconDoor=null;var buttonIconArrow=null;if(markFlag==="1"){buttonInner.addClass("record-clock-in");var buttonIcon=Recorder.view.createButtonArrowIcon(false);buttonIconDoor=buttonIcon.find(".door").first();buttonIconArrow=buttonIcon.find(".up-arrow").first();buttonInner.append($(buttonIcon))}else{if(markFlag==="2"){buttonInner.addClass("record-clock-out");var buttonIcon=Recorder.view.createButtonArrowIcon(true);buttonIconDoor=buttonIcon.find(".door").first();buttonIconArrow=buttonIcon.find(".down-arrow").first();buttonInner.append($(buttonIcon))}}var recordButtonMessage=$("<DIV>").addClass("record-btn-message").addClass("text-bold").text(text);if(text.length<=2){$(recordButtonMessage).addClass("btn-text-x-large")}else{if(text.length>2&&text.length<=4){$(recordButtonMessage).addClass("btn-text-large")}else{if(text.length>4){$(recordButtonMessage).addClass("btn-text-middle")}}}buttonInner.append($(recordButtonMessage));if(addClass){$(buttonOuter).addClass(addClass)}buttonOuter.append(buttonInner);buttonItem.append(buttonOuter);this.cache.buttonList.append(buttonItem);var buttonActive=false;if(callback){$(buttonOuter).click(function(e){buttonActive=true;$(this).addClass("record-btn-outer-active");buttonInner.addClass("record-btn-inner-active");if(markFlag!=="0"){buttonIconDoor.addClass("btn-door-icon-active");if(markFlag==="1"){$(this).addClass("record-clock-in-outer-active");buttonIconArrow.addClass("btn-up-arrow-icon-active")}else{if(markFlag==="2"){$(this).addClass("record-clock-out-outer-active");buttonIconArrow.addClass("btn-down-arrow-icon-active")}}}callback($(this).attr("id"),$(this).text(),this.className);setTimeout(function(){buttonActive=false;buttonOuter.removeClass("record-btn-outer-active");buttonInner.removeClass("record-btn-inner-active");if(markFlag!=="0"){buttonIconDoor.removeClass("btn-door-icon-active");if(markFlag==="1"){buttonOuter.removeClass("record-clock-in-outer-active");buttonIconArrow.removeClass("btn-up-arrow-icon-active")}else{if(markFlag==="2"){buttonOuter.removeClass("record-clock-out-outer-active");buttonIconArrow.removeClass("btn-down-arrow-icon-active")}}}},200);e.preventDefault()});$(buttonOuter).hover(function(){if(!buttonActive){buttonInner.addClass("record-btn-inner-hover");if(markFlag!=="0"){buttonIconDoor.addClass("btn-door-icon-hover");if(markFlag==="1"){buttonInner.addClass("record-clock-in-inner-hover");buttonIconArrow.addClass("btn-up-arrow-icon-hover")}else{if(markFlag==="2"){buttonInner.addClass("record-clock-out-inner-hover");buttonIconArrow.addClass("btn-down-arrow-icon-hover")}}}}},function(){buttonInner.removeClass("record-btn-inner-hover");if(markFlag!=="0"){buttonIconDoor.removeClass("btn-door-icon-hover");if(markFlag==="1"){buttonInner.removeClass("record-clock-in-inner-hover");buttonIconArrow.removeClass("btn-up-arrow-icon-hover")}else{if(markFlag==="2"){buttonInner.removeClass("record-clock-out-inner-hover");buttonIconArrow.removeClass("btn-down-arrow-icon-hover")}}}})}};ViewControl.prototype.createButtonArrowIcon=function(isDown){var icon=$("<DIV>").addClass("btn-arrow-icon");icon.append($("<DIV>").addClass("door"));if(isDown){icon.append($("<DIV>").addClass("down-arrow"))}else{icon.append($("<DIV>").addClass("up-arrow"))}return icon};ViewControl.prototype.showLocationStatus=function(isGetting,hasError,errorCode){if(isGetting){this.cache.locationArea.text(Recorder.i18N.getMessage("044"))}else{if(hasError){this.cache.locationArea.text(Recorder.i18N.getLocationErrorMessage(errorCode))}else{this.cache.locationArea.text(Recorder.i18N.getMessage("049"))}}};ViewControl.prototype.showLocationInfo=function(pos,watchId){var dateObj=new Date(pos.timestamp);var dateStr=dateObj.getHours()+":"+dateObj.getMinutes()+":"+dateObj.getSeconds();var posText=watchId+": "+pos.coords.latitude+", "+pos.coords.longitude+", "+pos.coords.accuracy+", "+pos.coords.speed+", "+pos.coords.heading+", "+dateStr;this.cache.locationInfo.text(posText);var posHigh=Recorder.geolocation.getHighPositon();var posLow=Recorder.geolocation.getLowPosition();if(posHigh!=null){var dateObjHigh=new Date(posHigh.timestamp);var dateStrHigh=dateObjHigh.getHours()+":"+dateObjHigh.getMinutes()+":"+dateObjHigh.getSeconds();var posTextHigh1="高精度位置情報: "+posHigh.coords.latitude+", "+posHigh.coords.longitude+", ";var posTextHigh2=posHigh.coords.accuracy+", "+posHigh.coords.speed+", "+posHigh.coords.heading+", "+dateStrHigh;this.cache.locationInfoHigh1.text(posTextHigh1);this.cache.locationInfoHigh2.text(posTextHigh2)}if(posLow!=null){var dateObjLow=new Date(posLow.timestamp);var dateStrLow=dateObjLow.getHours()+":"+dateObjLow.getMinutes()+":"+dateObjLow.getSeconds();var posTextLow1="低精度位置情報: "+posLow.coords.latitude+", "+posLow.coords.longitude+", ";var posTextLow2=posLow.coords.accuracy+", "+posLow.coords.speed+", "+posLow.coords.heading+", "+dateStrLow;this.cache.locationInfoLow1.text(posTextLow1);this.cache.locationInfoLow2.text(posTextLow2)}var location_info=document.getElementById("location_info");var location_info_low1=document.getElementById("location_info_low1");var location_info_low2=document.getElementById("location_info_low2");var location_info_high1=document.getElementById("location_info_high1");var location_info_high2=document.getElementById("location_info_high2");location_info.style.display="";location_info_low1.style.display="";location_info_low2.style.display="";location_info_high1.style.display="";location_info_high2.style.display=""};ViewControl.prototype.resetMap=function(){var location_info=document.getElementById("location_info");var location_info_low1=document.getElementById("location_info_low1");var location_info_low2=document.getElementById("location_info_low2");var location_info_high1=document.getElementById("location_info_high1");var location_info_high2=document.getElementById("location_info_high2");location_info.style.display="none";location_info_low1.style.display="none";location_info_low2.style.display="none";location_info_high1.style.display="none";location_info_high2.style.display="none";var i;for(i=0;i<layerArray.length;i++){map.removeLayer(layerArray[i])}};ViewControl.prototype.showEnvironments=function(iconPath,logoUrl,manifestPath,copyRight,freee_env_flag){if(~window.location.href.indexOf("personal_src")){iconPath="../personal/"+iconPath;manifestPath="../personal/"+manifestPath;logoUrl="../personal/"+logoUrl}this.cache.appIcon.attr("href",iconPath);this.cache.logo.attr("src",logoUrl).show();this.cache.manifest.attr("href",manifestPath);this.cache.copyRignt.text(copyRight);if(freee_env_flag==="true"){$("#IE_limit_date").text("2022年4月16日")}};ViewControl.prototype.showNames=function(sectionName,employeeName){this.cache.sectionName.text(sectionName);this.cache.employeeName.text(employeeName);if(Recorder.utility.isMobile()){this.cache.employeeName.addClass("text-large")}else{this.cache.employeeName.addClass("text-x-large")}};ViewControl.prototype.showLocalRecordInfo=function(count,callback){var _this=this;$(this.cache.localRecordInfo).unbind(".local_send");$(this.cache.localRecordInfo).removeClass("local-info-hover").removeClass("local-info-active");if(count===0){$(this.cache.localRecordInfo).hide()}else{$(this.cache.localRecordInfo).bind("click.local_send",function(){_this.cache.localRecordInfo.addClass("local-info-active");callback(false);setTimeout(function(){_this.cache.localRecordInfo.removeClass("local-info-active")},500)});$(this.cache.localRecordInfo).bind("mouseenter.local_send",function(){_this.cache.localRecordInfo.addClass("local-info-hover")});$(this.cache.localRecordInfo).bind("mouseleave.local_send",function(){_this.cache.localRecordInfo.removeClass("local-info-hover")});$(this.cache.localRecordInfo).text(Recorder.utility.stringFormat(Recorder.i18N.getMessage("050"),[count]));$(this.cache.localRecordInfo).show()}};ViewControl.prototype.showMessageByCanNotUse=function(isAccessable,isHttps){this.clearAll();if(!isAccessable){this.cache.sectionName.text(Recorder.i18N.getMessage("005"))}else{if(!isHttps){this.cache.sectionName.text(Recorder.i18N.getMessage("006"))}}};ViewControl.prototype.adjustButtonAlign=function(isCount){var num=isCount?this.buttonCount.count:this.buttonCount.record;this.cache.buttonList.removeClass("record-button-align-center").removeClass("record-button-align-left");var windowWidth=$(window).width();if(windowWidth<640){if(num<=1){this.cache.buttonList.addClass("record-button-align-center")}else{this.cache.buttonList.addClass("record-button-align-left")}}else{if(num<=4){this.cache.buttonList.addClass("record-button-align-center")}else{this.cache.buttonList.addClass("record-button-align-left")}}};ViewControl.prototype.createControlButtonForModal=function(text,classes){classes=classes?classes:{};var btnClasses={outer:{normal:"btn-control-outer",hover:"btn-control-outer-hover",active:"btn-control-outer-active",normalSize:"btn-control-outer-size-short",activeSize:"btn-control-outer-active-size-short"},inner:{normal:"btn-control-inner",hover:"btn-control-inner-hover",active:"btn-control-inner-active",normalSize:"btn-control-inner-size-short",activeSize:"btn-control-inner-active-size-short"},message:"btn-control-message"};$.extend(true,btnClasses,classes);var buttonOuter=$("<DIV>").addClass(btnClasses.outer.normal).addClass(btnClasses.outer.normalSize);var buttonInner=$("<DIV>").addClass(btnClasses.inner.normal).addClass(btnClasses.inner.normalSize);var buttonMessage=$("<DIV>").addClass(btnClasses.message).text(text);buttonInner.append(buttonMessage);buttonOuter.append(buttonInner);var clicked=false;buttonOuter.click(function(){clicked=true;buttonOuter.removeClass(btnClasses.outer.normalSize).addClass(btnClasses.outer.active).addClass(btnClasses.outer.activeSize);buttonInner.removeClass(btnClasses.inner.normalSize).addClass(btnClasses.inner.active).addClass(btnClasses.inner.activeSize);setTimeout(function(){clicked=false;buttonOuter.removeClass(btnClasses.outer.active).removeClass(btnClasses.outer.activeSize).addClass(btnClasses.outer.normalSize);buttonInner.removeClass(btnClasses.inner.active).removeClass(btnClasses.inner.activeSize).addClass(btnClasses.inner.normalSize)},200)});buttonOuter.hover(function(){if(!clicked){buttonOuter.addClass(btnClasses.outer.hover);buttonInner.addClass(btnClasses.inner.hover)}},function(){buttonOuter.removeClass(btnClasses.outer.hover);buttonInner.removeClass(btnClasses.inner.hover)});return buttonOuter};ViewControl.prototype.addOpenidConnectButtonForModal=function(openidConnectArea,url,name,value,companyStyle,imagePath){openidConnectArea.append($('<button class="'+companyStyle+'" type="button" onclick="location.href=\''+url+"'\" name="+name+" value="+value+'><img src="image/button/'+imagePath+'"></button>'))};ViewControl.prototype.hideAnnounceBatch=function(){if(!this.cache.announceCount){this.cache.announceCount=$(".announce-count")}this.cache.announceCount.hide()};ViewControl.prototype.showAnnounceBatch=function(count){if(!this.cache.announceCount){this.cache.announceCount=$(".announce-count")}this.cache.announceCount.text(count).show()};ViewControl.prototype.adjustWatchView=function(date){if(!date){return}this.cache.watchYearToDate.text(Recorder.i18N.getYearToDateStringWithWeekDay(date));this.cache.watchHourToSec.text(Recorder.utility.getHourToSecondString(date))};ViewControl.prototype.clearWatch=function(){this.cache.watchYearToDate.text("");this.cache.watchHourToSec.text("")};ViewControl.prototype.custmizeForDaikyo=function(text,callback){var menuIcon=$("#menu_icon");var historyButton=$("#history-button");menuIcon.hide();historyButton.show();historyButton.val(text);var link=$("<A>").attr("href","#").addClass("text-middle").text(text);historyButton.append(link);if(callback){historyButton.click(function(e){callback(this);e.preventDefault();e.stopPropagation()})}};Recorder.view=new ViewControl()})(jQuery);(function($){var _watchDate=null;var _compareDate=null;var _watchInterval=null;var _offset=null;function Watch(){}Watch.prototype.init=function(offset){Recorder.watch.destroy();Recorder.watch.setTimeZoneOffsetForWatch(offset);_offset=offset;_watchInterval=setInterval(function(){var date=new Date();if(!_compareDate){_compareDate=date}var diff=date.getTime()-_compareDate.getTime();if(diff==0||diff>=1000){_compareDate=date;Recorder.watch.setTimeZoneOffsetForWatchForCount(_offset);Recorder.view.adjustWatchView(Recorder.watch.getWatchDate())}},50)};Watch.prototype.updateTime=function(){var date=new Date();if(!_compareDate){_compareDate=date}var diff=date.getTime()-_compareDate.getTime();if(diff==0||diff>=1000){_compareDate=date;_watchDate.setTime(_watchDate.getTime()+1000);Recorder.view.adjustWatchView(Recorder.watch.getWatchDate())}};Watch.prototype.getDateObject=function(date,isUtc){if(!date){date=new Date()}else{var newDate=new Date();newDate.setTime(date.getTime());date=newDate}if(isUtc){return new Date(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds(),date.getUTCMilliseconds())}return date};Watch.prototype.setTimeZoneOffsetForWatch=function(offset){if(!_watchDate){if(offset==="not use"){_watchDate=Recorder.watch.getDateObject(null,false)}else{_watchDate=Recorder.watch.getDateObject(null,true)}}if(offset){var offsetNum=Number(offset);if(!isNaN(offsetNum)){_watchDate.setTime(_watchDate.getTime()+Number(offset))}}};Watch.prototype.setTimeZoneOffsetForWatchForCount=function(offset){if(offset==="not use"){_watchDate=Recorder.watch.getDateObject(null,false)}else{_watchDate=Recorder.watch.getDateObject(null,true)}if(offset){var offsetNum=Number(offset);if(!isNaN(offsetNum)){_watchDate.setTime(_watchDate.getTime()+Number(offset))}}};Watch.prototype.getWatchDate=function(){if(!_watchDate){return null}return Recorder.watch.getDateObject(_watchDate,false)};Watch.prototype.destroy=function(){if(_watchInterval){clearInterval(_watchInterval)}_watchDate=null;_compareDate=null;_offset=null;Recorder.view.clearWatch()};Watch.prototype.refreshWatch=function(){if(Recorder.userData&&Recorder.userData.timerecorder){Recorder.watch.init(Recorder.userData.timerecorder.time_zone_offset)}};Recorder=Recorder||{};Recorder.watch=new Watch()})(jQuery);(function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.MediaStreamTrack=window.MediaStreamTrack;window.URL=window.URL||window.webkitURL;var _meidaAvailable=navigator.getUserMedia?true:false;var _cameraData=[];var _cameraNum=null;var _localStream=null;var _audioAvailable=window.Audio?true:false;var _isCameraOptionNotUseable=false;function _changeCameraNum(){if(_cameraNum==null){_cameraNum=0}else{_cameraNum++;if(_cameraData.length==0||_cameraNum===_cameraData.length){_cameraNum=0}}}function _createCameraOptionObject(cameraNum){if(_cameraData.length==0){return{video:{width:{exact:320},height:{exact:180}},audio:false}}else{return{video:{optional:[{sourceId:_cameraData[_cameraNum].id}],mandatory:{maxWidth:320,maxHeight:180}},audio:false}}}var _fileAvailable=window.File?true:false;var _isMobileDevice=(Recorder.utility.isMobile()||Recorder.utility.isTablet())?true:false;var _fileReader=null;var _image=null;var _orientationNum=0;function UseMedia(){this.blockingCameraCapture=true;this.blockingChangeCamera=true;this.unAvailableDevide=true;this.cache={userMedia:{canvas:null,video:null,photoButton:null,sendButton:null},mediaCapture:{canvas:null,input:null,sendButton:null}};this.audio=null}var _callback=null;UseMedia.prototype.mediaUsable=function(){return _meidaAvailable||(_fileAvailable&&_isMobileDevice)};UseMedia.prototype.userMediaApiUseable=function(){return _meidaAvailable};UseMedia.prototype.init=function(){if(!Recorder.useMedia.mediaUsable()){return}if(_meidaAvailable){Recorder.useMedia.initGetUserMediaOptions()}};UseMedia.prototype.initMediaArea=function(callback,areaId){if(!Recorder.useMedia.mediaUsable()){return}_callback=callback;if(_meidaAvailable){_cameraNum=null;_changeCameraNum();Recorder.useMedia.initMediaAreaForGetUserMedia(areaId)}else{Recorder.useMedia.initMediaAreaForMediaCapture(areaId)}};UseMedia.prototype.cacheAll=function(){Recorder.useMedia.cache.userMedia.video=$("#video");Recorder.useMedia.cache.userMedia.canvas=$("#canvas");Recorder.useMedia.cache.userMedia.photoButton=$("#photo");Recorder.useMedia.cache.mediaCapture.canvas=$("#canvas");Recorder.useMedia.cache.mediaCapture.input=$("#image_file")};UseMedia.prototype.destroy=function(){_callback=null;if(Recorder.useMedia.mediaUsable()){if(Recorder.useMedia.userMediaApiUseable()){Recorder.useMedia.destroyStream()}else{Recorder.useMedia.destroyFileReader()}}};UseMedia.prototype.getControlButtonClassesBase=function(){return{outer:{normal:"btn-media-outer",hover:"btn-media-outer-hover",active:"btn-media-outer-active",normalSize:"btn-control-outer-size-long",activeSize:"btn-control-outer-active-size-long"},inner:{normal:"btn-media-inner",hover:"btn-media-inner-hover",active:"btn-media-inner-active",normalSize:"btn-control-inner-size-long",activeSize:"btn-control-inner-active-size-long"},message:""}};UseMedia.prototype.initGetUserMediaOptions=function(){_cameraData=[];if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){navigator.enumerateDevices=function(callback){navigator.mediaDevices.enumerateDevices().then(callback)}}if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)}if(!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices){navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)}if(navigator.enumerateDevices){navigator.enumerateDevices(function(data){for(var i=0,l=data.length;i<l;i++){if(data[i].kind==="video"||data[i].kind==="videoinput"){_cameraData.push(data[i])}}})}else{_isCameraOptionNotUseable=true}Recorder.useMedia.initAudio()};UseMedia.prototype.initMediaAreaForGetUserMedia=function(areaId){if(!_meidaAvailable){return}var area=$("#"+areaId);var container=$("<DIV>").addClass("container");var video=$("<VIDEO>").attr("id","video").attr("autoplay",true).addClass("video-area");var canvas=$("<CANVAS>").attr("id","canvas").addClass("photo-area").hide();var photoButtonClass=$.extend(true,this.getControlButtonClassesBase(),{outer:{normalSize:"btn-control-outer-size-middle",activeSize:"btn-control-outer-active-size-middle"},inner:{normalSize:"btn-control-inner-size-middle",activeSize:"btn-control-inner-active-size-middle"},message:"photo-button"});var changeButtonClass=this.getControlButtonClassesBase();var photoButton=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("089"),photoButtonClass).attr("id","photo");var changeButton=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("090"),changeButtonClass).attr("id","change_camera");container.append($("<DIV>").addClass("media-items").append($(video)).append($(canvas)));container.append($("<DIV>").addClass("media-items").append($(photoButton)).append($(changeButton)));area.append(container);if(!_isCameraOptionNotUseable&&_cameraData.length<=1){changeButton.hide()}Recorder.useMedia.cacheAll();Recorder.useMedia.setCamera();$(window).bind("orientationchange",function(e){if(!Recorder.useMedia.blockingChangeCamera){Recorder.useMedia.destroyStream();Recorder.useMedia.setCamera()}});video.bind("play",function(){Recorder.useMedia.unAvailableDevide=true;setTimeout(function(){var video=Recorder.useMedia.cache.userMedia.video.get(0);if(video.videoWidth<=10||video.videoHeight<=10){Recorder.useMedia.blockingChangeCamera=false;Recorder.useMedia.unAvailableDevide=true;Recorder.useMedia.blockingCameraCapture=true;Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("091"),null,null);Recorder.useMedia.destroyStream()}else{Recorder.useMedia.unAvailableDevide=false;Recorder.useMedia.blockingChangeCamera=false;Recorder.useMedia.blockingCameraCapture=false;Recorder.useMedia.resize(video.videoWidth,video.videoHeight)}},1500)});changeButton.click(function(){if(Recorder.useMedia.blockingChangeCamera){return}Recorder.useMedia.unAvailableDevide=true;Recorder.useMedia.blockingCameraCapture=true;Recorder.useMedia.changeCamera()})};UseMedia.prototype.setCamera=function(){if(_localStream){Recorder.useMedia.destroyStream()}var context=Recorder.useMedia.cache.userMedia.canvas.get(0).getContext("2d");navigator.getUserMedia(_createCameraOptionObject(_cameraNum),function(stream){_localStream=stream;var video=Recorder.useMedia.cache.userMedia.video.get(0);if(_isCameraOptionNotUseable){var ratio=Recorder.useMedia.getImageDecreaseRatioForUserMedia(video.videoWidth,video.videoHeight);video.width=video.videoWidth/ratio;video.height=video.videoHeight/ratio}video.srcObject=_localStream},function(error){Recorder.useMedia.blockingChangeCamera=false;Recorder.useMedia.unAvailableDevide=true;Recorder.useMedia.blockingCameraCapture=true;Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("091"),null,null);Recorder.useMedia.destroyStream()});Recorder.useMedia.cache.userMedia.photoButton.unbind("click.photo");Recorder.useMedia.cache.userMedia.photoButton.unbind("click.re-photo");Recorder.useMedia.cache.userMedia.photoButton.bind("click.photo",function(){if(Recorder.useMedia.unAvailableDevide){return}if(Recorder.useMedia.blockingCameraCapture){return}Recorder.useMedia.blockingChangeCamera=true;Recorder.useMedia.cache.userMedia.photoButton.unbind("click.photo");Recorder.useMedia.playAudio();var video=Recorder.useMedia.cache.userMedia.video.get(0);context.drawImage(video,0,0,video.width,video.height);Recorder.useMedia.cache.userMedia.canvas.show();Recorder.useMedia.cache.userMedia.video.hide();Recorder.useMedia.destroyStream();Recorder.useMedia.cache.userMedia.photoButton.find(".photo-button").text(Recorder.i18N.getMessage("092"));_callback(Recorder.useMedia.cache.userMedia.canvas.get(0).toDataURL());Recorder.useMedia.cache.userMedia.photoButton.bind("click.re-photo",function(){_callback(null);Recorder.useMedia.blockingChangeCamera=false;Recorder.useMedia.blockingCameraCapture=true;Recorder.useMedia.cache.userMedia.photoButton.unbind("click.re-photo");Recorder.useMedia.cache.userMedia.video.show();Recorder.useMedia.cache.userMedia.canvas.hide();Recorder.useMedia.setCamera();Recorder.useMedia.cache.userMedia.photoButton.find(".photo-button").text(Recorder.i18N.getMessage("089"))})})};UseMedia.prototype.changeCamera=function(){if(Recorder.useMedia.blockingChangeCamera){return}Recorder.useMedia.blockingChangeCamera=true;Recorder.useMedia.blockingCameraCapture=true;_callback(null);_changeCameraNum();Recorder.useMedia.setCamera()};UseMedia.prototype.destroyStream=function(){if(_localStream){if(_localStream.stop){_localStream.stop()}if(_localStream.getTracks){_localStream.getTracks()[0].stop()}Recorder.useMedia.cache.userMedia.video.get(0).srcObject=null;window.URL.revokeObjectURL(_localStream);_localStream=null;Recorder.useMedia.cache.userMedia.video.get(0).src=null}};UseMedia.prototype.resize=function(videoWidth,videoHeight){if(_isCameraOptionNotUseable||videoWidth>320){var ratio=Recorder.useMedia.getImageDecreaseRatioForUserMedia(videoWidth,videoHeight);Recorder.useMedia.cache.userMedia.video.get(0).width=videoWidth/ratio;Recorder.useMedia.cache.userMedia.video.get(0).height=videoHeight/ratio;Recorder.useMedia.cache.userMedia.canvas.get(0).width=videoWidth/ratio;Recorder.useMedia.cache.userMedia.canvas.get(0).height=videoHeight/ratio}else{Recorder.useMedia.cache.userMedia.video.get(0).width=videoWidth;Recorder.useMedia.cache.userMedia.video.get(0).height=videoHeight;Recorder.useMedia.cache.userMedia.canvas.get(0).width=videoWidth;Recorder.useMedia.cache.userMedia.canvas.get(0).height=videoHeight}};UseMedia.prototype.getImageDecreaseRatioForUserMedia=function(videoWidth,videoHeight){var max=videoWidth>=videoHeight?320:240;var target=videoWidth>=videoHeight?videoWidth:videoHeight;var ratio=1;while(max<=(target/ratio)){ratio++}return ratio};UseMedia.prototype.initAudio=function(){if(!_audioAvailable){return}Recorder.useMedia.audio=new Audio("");Recorder.useMedia.audio.autoplay=false;Recorder.useMedia.audio.src="../personal/audio/sound01.wav";Recorder.useMedia.audio.load()};UseMedia.prototype.playAudio=function(){if(!_audioAvailable){return}if(Recorder.useMedia.audio.currentTime&&Recorder.useMedia.audio.currentTime>0){Recorder.useMedia.audio.currentTime=0}Recorder.useMedia.audio.play()};UseMedia.prototype.initMediaAreaForMediaCapture=function(areaId){if(!_fileAvailable){return}var area=$("#"+areaId);var container=$("<DIV>").addClass("container");var file=$("<INPUT>").attr("id","image_file").attr("type","file").attr("accpt","image/*").attr("capture","camera").addClass("select-file");var selectButtonClass=$.extend(true,this.getControlButtonClassesBase(),{outer:{normalSize:"btn-control-outer-size-long",activeSize:"btn-control-outer-active-size-long"},inner:{normalSize:"btn-control-inner-size-long",activeSize:"btn-control-inner-active-size-long"}});var selectButton=Recorder.view.createControlButtonForModal(Recorder.i18N.getMessage("093"),selectButtonClass);var canvas=$("<CANVAS>").attr("id","canvas").addClass("photo-area-capture");container.append($("<DIV>").addClass("media-items").append($(file)).append($(selectButton)));container.append($("<DIV>").addClass("media-items").append($(canvas)));area.append(container);Recorder.useMedia.cacheAll();file.change(function(){Recorder.useMedia.selectFile()});selectButton.click(function(){file.click()});$(window).bind("load orientationchange",function(e){var rotateA=window.orientation/90;var rotateB=Math.abs(window.orientation)%90;if(rotateB===0){_orientationNum=rotateA}})};UseMedia.prototype.selectFile=function(){Recorder.useMedia.destroyFileReader();var file=Recorder.useMedia.cache.mediaCapture.input.get(0).files[0];if(file==null){_callback(null);Recorder.useMedia.hideImage();Recorder.useMedia.blockingSend=true;return}if(!file.type.match(/^image\/(png|jpeg|jpg|gif)$/)){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("094"),null,null);_callback(null);Recorder.useMedia.cache.mediaCapture.input.val("");Recorder.useMedia.hideImage();Recorder.useMedia.blockingSend=true;return}Recorder.useMedia.blockingSend=false;var context=Recorder.useMedia.cache.mediaCapture.canvas.get(0).getContext("2d");_image=new Image();_fileReader=new FileReader();_fileReader.onload=function(event){_image.onload=function(){var ratio=Recorder.useMedia.getImageDecreaseRatio();var canvasWidth=_image.width/ratio;var canvasHeight=_image.height/ratio;switch(_orientationNum){case 0:Recorder.useMedia.cache.mediaCapture.canvas.get(0).width=canvasHeight;Recorder.useMedia.cache.mediaCapture.canvas.get(0).height=canvasWidth;break;default:Recorder.useMedia.cache.mediaCapture.canvas.get(0).width=canvasWidth;Recorder.useMedia.cache.mediaCapture.canvas.get(0).height=canvasHeight;break}switch(_orientationNum){case -1:context.rotate(Math.PI);context.translate(-canvasWidth,-canvasHeight);break;case 0:context.rotate(0.5*Math.PI);context.translate(0,-canvasHeight);break}context.save();context.drawImage(_image,0,0,canvasWidth,canvasHeight);Recorder.useMedia.cache.mediaCapture.canvas.show();_callback(Recorder.useMedia.cache.mediaCapture.canvas.get(0).toDataURL())};_image.src=event.target.result};_fileReader.readAsDataURL(file)};UseMedia.prototype.getImageDecreaseRatio=function(){var max=240;var windowWidth=$(window).width();var windowHeight=$(window).height();var imageWidth=_image.width;var imageHeight=_image.height;var target,compare;if(imageWidth>=imageHeight){target=imageWidth;compare=windowWidth}else{target=imageHeight;compare=windowHeight}if(compare>max){compare=max}var ratio=1;while(compare<=(target/ratio)){ratio++}return ratio};UseMedia.prototype.destroyFileReader=function(){if(_fileReader){_fileReader=null}if(_image){_image=null}};UseMedia.prototype.hideImage=function(){var context=Recorder.useMedia.cache.mediaCapture.canvas.get(0).getContext("2d");context.clearRect(0,0,Recorder.useMedia.cache.mediaCapture.canvas.get(0).width,Recorder.useMedia.cache.mediaCapture.canvas.get(0).height)};Recorder=Recorder||{};Recorder.useMedia=new UseMedia()})();(function(){Recorder=Recorder||{};var watchId=null;var watchIdHigh=null;var watchIdLow=null;var latitude,longitude,errorCode;var hasError=false;var gettingNow=false;var highSuccessFlg=false;var highAccuracyFlg=false;var highPos=null;var lowPos=null;var AcqStartTimeHigh=null;var AcqEndTimeHigh=null;var AcqStartTimeLow=null;var AcqEndTimeLow=null;var optionsHigh={enableHighAccuracy:true,timeout:15000,maximumAge:0};var optionsLow={enableHighAccuracy:false,timeout:15000,maximumAge:0};var optionsHighSlow={enableHighAccuracy:true,timeout:30000,maximumAge:0};var optionsLowSlow={enableHighAccuracy:false,timeout:30000,maximumAge:0};function getLocationBase(){gettingNow=true;Recorder.view.showLocationStatus(gettingNow,false,null);if(!Recorder.utility.isInternetExplorer()){if(navigator.geolocation){getCurrentPositionHigh().then(getCurrentPositionLow).then(selectWatchLocation)}else{setError(-1);Recorder.view.showLocationStatus(gettingNow,hasError,errorCode)}}else{watchId=navigator.geolocation.watchPosition(function(position){highPos=position;setLocation(position);return},function(error){handleError(error);return},optionsLowSlow)}}function selectWatchLocation(){if(watchIdHigh!==null){navigator.geolocation.clearWatch(watchIdHigh);watchIdHigh=null}if(watchIdLow!==null){navigator.geolocation.clearWatch(watchIdLow);watchIdLow=null}if((!highSuccessFlg)){AcqStartTimeLow=Recorder.watch.getDateObject(null,false);watchId=navigator.geolocation.watchPosition(function(position){lowPos=position;AcqEndTimeLow=Recorder.watch.getDateObject(null,false);setLocation(position);return},function(error){handleError(error);return},optionsLowSlow)}else{AcqStartTimeHigh=Recorder.watch.getDateObject(null,false);watchId=navigator.geolocation.watchPosition(function(position){highPos=position;AcqEndTimeHigh=Recorder.watch.getDateObject(null,false);setLocation(position);return},function(error){handleError(error);return},optionsHighSlow)}}var getCurrentPositionLow=function(){var deferred=new $.Deferred();AcqStartTimeLow=Recorder.watch.getDateObject(null,false);watchIdLow=navigator.geolocation.watchPosition(function(position){lowPos=position;AcqEndTimeLow=Recorder.watch.getDateObject(null,false);setLocation(position);return deferred.resolve()},function(error){return deferred.resolve()},optionsLow);return deferred.promise()};var getCurrentPositionHigh=function(){var deferred=new $.Deferred();AcqStartTimeHigh=Recorder.watch.getDateObject(null,false);watchIdHigh=navigator.geolocation.watchPosition(function(position){highPos=position;highSuccessFlg=true;AcqEndTimeHigh=Recorder.watch.getDateObject(null,false);setLocation(position);return deferred.resolve()},function(error){return deferred.resolve()},optionsHigh);return deferred.promise()};function setBetterLocation(){var lowPosExtFlg=false;var highPosExtFlg=false;var sysDate=new Date();var differenceLow=null;var differenceHigh=null;if(lowPos!==null){var lowPosDate=new Date(lowPos.timestamp);differenceLow=compareDate(sysDate,lowPosDate);if(differenceLow<60000){lowPosExtFlg=true}}if(highPos!==null){var highPosDate=new Date(highPos.timestamp);differenceHigh=compareDate(sysDate,highPosDate);if(differenceHigh<60000){highPosExtFlg=true}}if(!lowPos&&!highPos){latitude=null;longitude=null;hasError=false;errorCode=null}else{if(!lowPos&&highPos){latitude=highPos.coords.latitude;longitude=highPos.coords.longitude;hasError=false;errorCode=null;highAccuracyFlg=true}else{if(lowPos&&!highPos){latitude=lowPos.coords.latitude;longitude=lowPos.coords.longitude;hasError=false;errorCode=null;highAccuracyFlg=false}else{var accuracyLowCheck=lowPos.coords.accuracy;var accuracyHighCheck=highPos.coords.accuracy;if(accuracyHighCheck>accuracyLowCheck){latitude=lowPos.coords.latitude;longitude=lowPos.coords.longitude;hasError=false;errorCode=null;highAccuracyFlg=false}else{latitude=highPos.coords.latitude;longitude=highPos.coords.longitude;hasError=false;errorCode=null;highAccuracyFlg=true}}}}return}function setPosData(pos,startDate,endDate){if(pos==null){return""}var posStr=pos.timestamp+","+pos.coords.latitude+","+pos.coords.longitude+","+pos.coords.altitude+","+pos.coords.accuracy+","+pos.coords.altitudeAccuracy+","+pos.coords.heading+","+pos.coords.speed+","+startDate+","+endDate;return posStr}function compareDate(dt1,dt2){var diff=dt1-dt2;return diff}function setLocation(pos){gettingNow=false;if(pos.coords.accuracy&&pos.coords.accuracy>1000){setError(998);Recorder.view.showLocationStatus(gettingNow,hasError,errorCode)}else{if(pos.coords.latitude&&pos.coords.longitude){setBetterLocation();Recorder.view.showLocationStatus(gettingNow,hasError,errorCode)}else{setError(999);Recorder.view.showLocationStatus(gettingNow,hasError,errorCode)}}if(Recorder.userData.user){if(Recorder.userData.user.mode==="1"){Recorder.view.showLocationInfo(pos,watchId)}}}function handleError(a){switch(a.code){case 1:setError(100);break;case 2:setError(200);break;case 3:setError(300);break;default:setError(999);break}Recorder.view.showLocationStatus(gettingNow,hasError,errorCode)}function setError(code){gettingNow=false;latitude=null;longitude=null;hasError=true;errorCode=code;highSuccessFlg=false;highPos=null;lowPos=null}function refrashParameter(){gettingNow=false;latitude=null;longitude=null;hasError=false;errorCode=null;highSuccessFlg=false;highPos=null;lowPos=null;var AcqStartTimeHigh=null;var AcqEndTimeHigh=null;var AcqStartTimeLow=null;var AcqEndTimeLow=null}function Geolocation(){}Geolocation.prototype.getLocation=function(){if(Recorder.userData.timerecorder.use_gps_flag==="1"){getLocationBase()}};Geolocation.prototype.refreshLocation=function(){if(watchIdHigh!==null){navigator.geolocation.clearWatch(watchIdHigh);watchIdHigh=null}if(watchIdLow!==null){navigator.geolocation.clearWatch(watchIdLow);watchIdLow=null}if(watchId!==null){navigator.geolocation.clearWatch(watchId);refrashParameter();Recorder.geolocation.getLocation()}};Geolocation.prototype.destroyLocation=function(){if(watchIdHigh!==null){navigator.geolocation.clearWatch(watchIdHigh);watchIdHigh=null}if(watchIdLow!==null){navigator.geolocation.clearWatch(watchIdLow);watchIdLow=null}if(watchId!==null){navigator.geolocation.clearWatch(watchId);refrashParameter()}};Geolocation.prototype.isGetting=function(){return gettingNow};Geolocation.prototype.hasError=function(){return hasError};Geolocation.prototype.getErrorCode=function(){return errorCode};Geolocation.prototype.getLatitude=function(){return latitude};Geolocation.prototype.getLongitude=function(){return longitude};Geolocation.prototype.getHighAccuracyFlg=function(){return highAccuracyFlg};Geolocation.prototype.getHighPositonToString=function(){return setPosData(highPos,AcqStartTimeHigh,AcqEndTimeHigh)};Geolocation.prototype.getLowPositionToString=function(){return setPosData(lowPos,AcqStartTimeLow,AcqEndTimeLow)};Geolocation.prototype.getHighPositon=function(){return highPos};Geolocation.prototype.getLowPosition=function(){return lowPos};Recorder.geolocation=new Geolocation()})();(function($){Recorder=Recorder||{};var _blocking=false;let _previousButtonName="";let _previousDate=null;function ResetPreviousClick(){_previousButtonName="";_previousDate=null}function Control(){this.nowCountShowing=false}Control.prototype.blocked=function(){if(_blocking){return true}_blocking=true;return false};Control.prototype.unBlock=function(){_blocking=false};Control.prototype.init=function(){Recorder.view.clearAll();if(!Recorder.utility.isAccessable()){Recorder.view.showMessageByCanNotUse(true,false);return}setTimeout(function(){Recorder.control.setEnvironment()},100);if(!Recorder.network.isHttps()){Recorder.view.showMessageByCanNotUse(false,true);return}Recorder.userData={};if(Recorder.storage.hasOpenidConnectServiceCode()){Recorder.storage.removeOpenidConnectServiceCode()}let result;let authParam;let oidcServiceCode;if(Recorder.modal.freeeOpenidConnectEnabled()){result=Recorder.utility.getUrlParam("result");authParam=Recorder.utility.getUrlParam("authParam");oidcServiceCode=Recorder.utility.getUrlParam("oidc_service_code")}if(Recorder.modal.freeeOpenidConnectEnabled()&&(typeof authParam!=="undefined")&&result==="SUCCESS"){Recorder.storage.saveOpenidConnectServiceCode(oidcServiceCode);Recorder.control.requestEmployeeSectionList(authParam,oidcServiceCode)}else{if(Recorder.modal.freeeOpenidConnectEnabled()&&result==="FAILED"){Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton);Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("116"),null,null)}else{if(!Recorder.storage.hasSetting()){Recorder.modal.samlEnabled()&&Recorder.control.loginIfSamlAuthenticated();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton)}else{Recorder.userData=Recorder.storage.getSetting();Recorder.i18N.setMessageMap(Recorder.userData.messages);Recorder.storage.setSuffix(Recorder.userData.user.user_token);Recorder.control.verifySavedAccount()}}}};Control.prototype.setEnvironment=function(){var environment=Recorder.storage.getEnvironment();if(environment){Recorder.view.showEnvironments(environment.icon_path,environment.logo_path,environment.manifest_path,environment.copy_right,environment.freee_env_flag)}Recorder.network.connectServer({sendData:{page_id:"get_environment"}},function(data,status,xhr,sendData){if(data&&data.result==="OK"){Recorder.view.showEnvironments(data.environment.icon_path,data.environment.logo_path,data.environment.manifest_path,data.environment.copy_right,data.environment.freee_env_flag);Recorder.storage.saveEnvironment(data.environment);if(data.environment.access_protocol==="https"&&location.protocol==="http:"){location.replace(location.href.replace(/http:/,"https:"))}}},function(xhr,status,errorThrown,data){},Recorder.Consts.GATEWAY_BASE)};Control.prototype.clickAccountWindowSendButton=function(id,pass){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{page_id:"account_verify",account:id,password:pass}},Recorder.control.accountConnectSuccess,Recorder.control.accountConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.clickTwoFactorAuthenticationWindowSendButton=function(id,pass,code){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{page_id:"account_verify",account:id,password:pass,two_factor_authentication_code:code}},Recorder.control.accountConnectSuccess,Recorder.control.accountConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.accountConnectSuccess=function(data,status,xhr,sendData){if(!data||data.result==="NG"){var errorCode=data&&data.code?data.code:"";if(data.code==="097"){Recorder.modal.showS3NecUserError()}else{var orgId=sendData&&sendData.account?sendData.account:null;var orgPass=sendData&&sendData.password?sendData.password:null;if(data.code==="112"||data.code==="113"){if(data.code==="113"){Recorder.utility.alertWithCallback(Recorder.i18N.getAccountErrorMessage(errorCode),null,null)}Recorder.modal.showTwoFactorAuthenticationForm(false,Recorder.control.clickTwoFactorAuthenticationWindowSendButton,orgId,orgPass);Recorder.control.unBlock()}else{Recorder.utility.alertWithCallback(Recorder.i18N.getAccountErrorMessage(errorCode),null,null);Recorder.control.unBlock();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton,orgId,orgPass)}}}else{if(data&&data.result==="NONE"){Recorder.control.unBlock()}else{Recorder.storage.saveSetting(data.user_data);Recorder.userData=data.user_data;Recorder.i18N.setMessageMap(data.user_data.messages);Recorder.storage.setSuffix(Recorder.userData.user.user_token);Recorder.announce.compareAnnounceMessageDataFromServer(data.announces);Recorder.view.setButtonCount(Recorder.userData.timerecorder.record_button.length,Recorder.userData.timerecorder.count_button.length);Recorder.watch.init(Recorder.userData.timerecorder.time_zone_offset);Recorder.control.adjustAllWindowItem();Recorder.control.adjustLocalData();Recorder.control.sendLocalData(true);Recorder.modal.hide();Recorder.geolocation.getLocation();ResetPreviousClick();Recorder.notification.showMessage(Recorder.i18N.getMessage("007"))}}};Control.prototype.accountConnectError=function(xhr,status,errorThrown,sendData){Recorder.utility.alertWithCallback(Recorder.i18N.getAccountErrorMessage(null),null,null);Recorder.control.unBlock();var orgId=sendData&&sendData.account?sendData.account:null;var orgPass=sendData&&sendData.password?sendData.password:null;Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton,orgId,orgPass)};Control.prototype.clickSamlLoginButton=function(companyCode){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{page_id:"saml_account_verify1",company_code:companyCode,location:location.href}},Control.prototype.samlConnectSuccess,Control.prototype.accountConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.clickSamlSettingsSelectButton=function(samlSettingsId,location){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{page_id:"saml_account_verify2",saml_settings_id:samlSettingsId,location:location.href}},Control.prototype.samlConnectSuccess,Control.prototype.accountConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.samlConnectSuccess=function(data,status,xhr,sendData){if(data&&data.result==="OK"){const code=data.code;if(code==="exists_multiple_idp_settings"){Recorder.modal.showSamlLogin2(data.idpSettings);Recorder.control.unBlock();return}window.location.href=data.redirectUrl}else{console.error("Saml Connect NG");console.error(data);Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("107"),null,null);Recorder.control.unBlock();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton)}Recorder.control.unBlock()};Control.prototype.loginIfSamlAuthenticated=function(){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{page_id:"saml_account_verify3"}},Recorder.control.accountConnectSuccess,Recorder.control.accountConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.requestEmployeeSectionList=function(authParam,oidcServiceCode){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{page_id:"openid_connect_linkage_user_list",authParam:authParam,oidc_service_code:oidcServiceCode}},Control.prototype.recievedEmployeeSectionListRequest,Control.prototype.accountConnectError,Recorder.Consts.GATEWAY_OPENID_CONNECT)};Control.prototype.recievedEmployeeSectionListRequest=function(data){if(data&&data.result==="OK"){if(!data.loginEnabledUsersSelectionList){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("110"),null,null);Recorder.control.unBlock();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton);return}if(data.loginEnabledUsersSelectionList.length===1){Recorder.control.unBlock();Recorder.control.verifyRequestOpenidConnectAccount(data.accessKey,data.loginEnabledUsersSelectionList[0].selectionParam)}else{if(data.loginEnabledUsersSelectionList.length>=2){Recorder.modal.showUserSelectionWindow(data.accessKey,data.loginEnabledUsersSelectionList)}else{Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("110"),null,null);Recorder.control.unBlock();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton)}}}else{const errorCode=data&&data.code?data.code:"";Recorder.utility.alertWithCallback(Recorder.i18N.getMessage(errorCode),null,null);Recorder.control.unBlock();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton)}};Control.prototype.verifyRequestOpenidConnectAccount=function(accessKey,selectionParam){if(Recorder.control.blocked()){return}const oidcServiceCode=Recorder.storage.getOpenidConnectServiceCode();Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{page_id:"openid_connect_account_verify",oidc_service_code:oidcServiceCode,accessKey:accessKey,userInfo:selectionParam}},Control.prototype.accountConnectSuccess,Control.prototype.accountConnectError,Recorder.Consts.GATEWAY_OPENID_CONNECT);Recorder.storage.removeOpenidConnectServiceCode()};Control.prototype.verifySavedAccount=function(){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{token:Recorder.userData.token.token_a,user_token:Recorder.userData.user.user_token,timerecorder_id:Recorder.view.cache.timerecorders.val()}},Recorder.control.verifySavedAccountConnectSuccess,Recorder.control.verifySavedAccountConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.verifySavedAccountConnectSuccess=function(data,status,xhr,sendData){if(!data||data.result==="NG"){if(data.code==="097"){Recorder.control.adjustLocalData();Recorder.control.sendLocalData(true);Recorder.modal.showS3NecUserError();return}else{if(data&&data.code!=="998"){var errorCode=data&&data.code?data.code:"";Recorder.utility.alertWithCallback(Recorder.i18N.getAccountErrorMessage(errorCode),null,null);Recorder.control.unBlock();Recorder.modal.showAccount(false,Recorder.control.clickAccountWindowSendButton);return}}}else{Recorder.storage.saveSetting(data.user_data);Recorder.userData=data.user_data;Recorder.i18N.setMessageMap(data.user_data.messages);Recorder.storage.setSuffix(Recorder.userData.user.user_token);Recorder.announce.compareAnnounceMessageDataFromServer(data.announces);Recorder.view.setButtonCount(Recorder.userData.timerecorder.record_button.length,Recorder.userData.timerecorder.count_button.length);Recorder.watch.init(Recorder.userData.timerecorder.time_zone_offset)}Recorder.control.adjustAllWindowItem();Recorder.control.adjustLocalData();Recorder.control.sendLocalData(true);Recorder.geolocation.getLocation();Recorder.modal.hide()};Control.prototype.verifySavedAccountConnectError=function(xhr,status,errorThrown,sendData){Recorder.i18N.setMessageMap(Recorder.userData.messages);Recorder.storage.setSuffix(Recorder.userData.user.user_token);Recorder.view.setButtonCount(Recorder.userData.timerecorder.record_button.length,Recorder.userData.timerecorder.count_button.length);Recorder.control.adjustAllWindowItem();Recorder.view.showLocalRecordInfo(Recorder.control.getLocalDataCount(),Recorder.control.sendLocalData);Recorder.watch.init(Recorder.userData.timerecorder.time_zone_offset);Recorder.geolocation.getLocation();Recorder.modal.hide()};Control.prototype.setMenuList=function(){Recorder.view.clearMenu();if(Recorder.userData.customize.company.isDaikyo==="1"){Recorder.view.custmizeForDaikyo(Recorder.i18N.getMessage("009"),Recorder.control.clickHistoryMenu);return}var allowNormalLogin=true;if(Recorder.modal.samlEnabled()){allowNormalLogin=Recorder.userData.allowEmployeeNormalLogin!=="false"}if(Recorder.userData.timerecorder.show_timecard_flag==="1"&&allowNormalLogin){Recorder.view.addMenuItem(Recorder.i18N.getMessage("010"),Recorder.control.clickTimecardMenu)}if(Recorder.userData.timerecorder.use_count_flag==="1"&&!Recorder.utility.isEmptyArray(Recorder.userData.timerecorder.count_button)){Recorder.view.addMenuItem(Recorder.i18N.getMessage("008"),Recorder.control.clickCountMenu)}Recorder.view.addMenuItem(Recorder.i18N.getMessage("009"),Recorder.control.clickHistoryMenu);var savedAnnounceMessage=Recorder.storage.getAnnounceMessage();if(savedAnnounceMessage){Recorder.view.addMenuItemForMessage(Recorder.i18N.getMessage("063"),Recorder.control.clickAnnounceMessageMenu)}Recorder.view.addMenuItem(Recorder.i18N.getMessage("067"),Recorder.control.clickChangeTheme);if(Recorder.userData.user.mode==="1"){Recorder.view.addMenuItem(Recorder.i18N.getMessage("011"),Recorder.control.clickSendSavedDataMenu);Recorder.view.addMenuItem(Recorder.i18N.getMessage("068"),Recorder.control.clickCheckUpdate)}Recorder.view.addMenuItem(Recorder.i18N.getMessage("012"),Recorder.control.clickLogoutMenu)};Control.prototype.clickCountMenu=function(item){var link=$(item).children().get(0);if(Recorder.control.nowCountShowing){$(link).text(Recorder.i18N.getMessage("008"));Recorder.control.setRecordButton(false);Recorder.control.nowCountShowing=false}else{$(link).text(Recorder.i18N.getMessage("013"));Recorder.control.setRecordButton(true);Recorder.control.nowCountShowing=true}};Control.prototype.clickHistoryMenu=function(){if(Recorder.control.blocked()){return}Recorder.modal.showHistory(Recorder.storage.getRecordHistory(),Recorder.storage.getCountHistory())};Control.prototype.clickTimecardMenu=function(){if(Recorder.control.blocked()){return}var hashData={input_hash:"",record_timestamp:Recorder.utility.getFullDateString(new Date())};if(Recorder.userData.timerecorder.need_password==="1"){Recorder.modal.showPassword(Recorder.control.getTimecardUrl,hashData)}else{Recorder.control.getTimecardUrl(hashData)}};Control.prototype.getTimecardUrl=function(timeHash){Recorder.modal.showLoading();Recorder.network.connectServer({sendData:{token:Recorder.userData.token.token_f,user_token:Recorder.userData.user.user_token,input_hash:timeHash.input_hash,timestamp:timeHash.record_timestamp}},function(data,status,xhr,sendData){if(!data||data.result==="NG"){Recorder.notification.showMessage(Recorder.i18N.getMessage("004"))}else{window.location.href=Recorder.network.getBaseUrl()+"/"+data.location+data.params}Recorder.modal.hide()},function(xhr,status,errorThrown,sendData){Recorder.notification.showMessage(Recorder.i18N.getMessage("004"));Recorder.modal.hide()},Recorder.Consts.GATEWAY_BASE)};Control.prototype.clickAnnounceMessageMenu=function(){Recorder.announce.showAnnounceMessage()};Control.prototype.clickSendSavedDataMenu=function(){if(Recorder.control.blocked()){return}Recorder.modal.showLoading();var datas=Recorder.storage.getAllSavedData();datas.VERSION=Recorder.Consts.VERSION;Recorder.network.connectServer({sendData:{token:Recorder.userData.token.token_g,user_token:Recorder.userData.user.user_token,saved_params:JSON.stringify(datas)}},function(data,status,xhr,sendData){if(!data||data.result==="NG"){Recorder.notification.showMessage(Recorder.i18N.getMessage("014"))}else{Recorder.notification.showMessage(Recorder.i18N.getMessage("015"))}Recorder.modal.hide()},function(xhr,status,errorThrown,sendData){Recorder.notification.showMessage(Recorder.i18N.getMessage("014"));Recorder.modal.hide()},Recorder.Consts.GATEWAY_BASE)};Control.prototype.clickLogoutMenu=function(){if(Recorder.control.blocked()){return}Recorder.utility.confirmWithCallback(Recorder.i18N.getMessage("016"),function(){Recorder.storage.removeSetting();Recorder.storage.removeEnvironment();Recorder.storage.removeTheme();Recorder.view.resetTheme();Recorder.i18N.setMessageMap(null);Recorder.watch.destroy();Recorder.control.unBlock();Recorder.view.resetMap();Recorder.geolocation.destroyLocation();if(window.location.search===""){Recorder.control.init()}else{window.location.href=window.location.href.split("?")[0]}Recorder.view.cache.timerecorders.hide()},function(){Recorder.modal.hide()},null,null)};Control.prototype.clickCheckUpdate=function(){Recorder.serviceWorkerMessage.sendMessage({command:"checkUpdate"})};Control.prototype.clickChangeTheme=function(){Recorder.view.toggleTheme()};Control.prototype.clickRecordButton=function(id,buttonName,className){if(Recorder.control.blocked()){return}if(Recorder.userData.timerecorder.use_gps_flag==="1"&&Recorder.userData.timerecorder.no_gps_no_record==="1"){if(!Recorder.geolocation.getLatitude()||!Recorder.geolocation.getLongitude()){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("017"),null,null);Recorder.geolocation.getLocation();Recorder.control.unBlock();return}}let nowDate=new Date();let seconds=0;if(_previousDate!=null&&_previousButtonName===buttonName){seconds=(nowDate.getTime()-_previousDate.getTime())/1000;if(seconds<Number(Recorder.userData.timerecorder.same_code_reauthentication_interval_sec)){Recorder.utility.alertWithCallback(Recorder.i18N.getMessage("146"),null,null);Recorder.control.unBlock();return}}else{_previousButtonName=buttonName}_previousDate=nowDate;var array=id.split("_");var timerecorderId=Recorder.view.cache.timerecorders.val();var historyData=Recorder.factory.createRecordHistory(array[1],buttonName,timerecorderId);historyData.latitude=Recorder.geolocation.getLatitude();historyData.longitude=Recorder.geolocation.getLongitude();historyData.highAcPos=Recorder.geolocation.getHighPositonToString();historyData.lowAcPos=Recorder.geolocation.getLowPositionToString();historyData.highAccuracyFlg=Recorder.geolocation.getHighAccuracyFlg();if(Recorder.userData.timerecorder.need_password==="1"){historyData.credential_code=Recorder.Consts.CredentialCode.PASSWORD;if(Recorder.userData.timerecorder.use_camera_on_record_flag==="1"&&Recorder.useMedia.mediaUsable()){Recorder.modal.showCamera(Recorder.control.notifyVerifiedConnect,historyData,true)}else{Recorder.modal.showPassword(Recorder.control.notifyVerifiedConnect,historyData)}}else{if(Recorder.userData.timerecorder.use_camera_on_record_flag==="1"&&Recorder.useMedia.mediaUsable()){Recorder.modal.showCamera(Recorder.control.notifyVerifiedConnect,historyData,false)}else{Recorder.control.notifyVerifiedConnect(historyData)}}};Control.prototype.notifyVerifiedConnect=function(historyData){Recorder.modal.showLoading();if(historyData.latitude&&historyData.longitude){if(historyData.credential_code===Recorder.Consts.CredentialCode.CLICK){historyData.credential_code=Recorder.Consts.CredentialCode.CLICK_LOCATION}else{if(historyData.credential_code===Recorder.Consts.CredentialCode.PASSWORD){historyData.credential_code=Recorder.Consts.CredentialCode.PASSWORD_LOCATION}}}if(historyData.record_image){if(historyData.credential_code===Recorder.Consts.CredentialCode.CLICK_LOCATION){historyData.credential_code=Recorder.Consts.CredentialCode.CAMERA_LOCATION}else{if(historyData.credential_code===Recorder.Consts.CredentialCode.PASSWORD_LOCATION){historyData.credential_code=Recorder.Consts.CredentialCode.CAMREA_LOCATION_PASSWORD}else{if(historyData.credential_code===Recorder.Consts.CredentialCode.PASSWORD){historyData.credential_code=Recorder.Consts.CredentialCode.CAMERA_PASSWORD}else{historyData.credential_code=Recorder.Consts.CredentialCode.CAMERA}}}}var sendData=Recorder.factory.recordHistoryToRecordData(historyData,false);sendData.token=Recorder.userData.token.token_b;Recorder.network.connectServer({sendData:sendData,processData:historyData},Recorder.control.notifyVerifiedConnectSuccess,Recorder.control.notifyVerifiedConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.notifyVerifiedConnectSuccess=function(data,status,xhr,historyData){historyData.xhr_statuc_code=xhr.status;historyData.send_timestamp=Recorder.utility.getFullDateString(new Date());var message="";if(!data||data.result==="NG"){var errorCode=data&&data.code?data.code:"";historyData.status=Recorder.Consts.HistoryStatus.RESULT_NG;historyData.error_code=errorCode?errorCode:Recorder.Consts.ErrorCode.AJAX_ERROR;if(!data||data.code==="998"){historyData.status=Recorder.Consts.HistoryStatus.SAVED_LOCAL;Recorder.storage.addLocalRecord(historyData)}else{ResetPreviousClick()}message=Recorder.i18N.getRecordErrorMessage(errorCode)}else{historyData.status=Recorder.Consts.HistoryStatus.RESULT_OK;if(data.image_result){historyData.image_result=data.image_result;if(data.image_result!==Recorder.Consts.ImageResult.NONE&&data.image_result!==Recorder.Consts.ImageResult.RESULT_OK){Recorder.utility.alertWithCallback(Recorder.i18N.getImageSendErrorMessage(data.image_result),null,null)}}message=Recorder.i18N.getMessage("026")}historyData.record_image="";Recorder.storage.addRecordHistory(historyData);Recorder.view.showLocalRecordInfo(Recorder.control.getLocalDataCount(),Recorder.control.sendLocalData);Recorder.modal.hide();Recorder.notification.showMessage(Recorder.utility.stringFormat(message,[historyData.name]))};Control.prototype.notifyVerifiedConnectError=function(xhr,status,errorThrown,historyData){historyData.xhr_statuc_code=xhr.status;historyData.send_timestamp=Recorder.utility.getFullDateString(new Date());historyData.error_code=Recorder.Consts.ErrorCode.AJAX_ERROR;historyData.status=Recorder.Consts.HistoryStatus.RESULT_NG;var errorCodeForMessage="000";if(Recorder.network.isNeedSaveStatusByError(xhr.status,status)){errorCodeForMessage="";historyData.status=Recorder.Consts.HistoryStatus.SAVED_LOCAL;Recorder.storage.addLocalRecord(historyData)}else{ResetPreviousClick()}historyData.record_image="";Recorder.storage.addRecordHistory(historyData);Recorder.view.showLocalRecordInfo(Recorder.control.getLocalDataCount(),Recorder.control.sendLocalData);Recorder.modal.hide();Recorder.notification.showMessage(Recorder.utility.stringFormat(Recorder.i18N.getRecordErrorMessage(errorCodeForMessage),[historyData.name]))};Control.prototype.clickCountButton=function(id,buttonName,className){if(Recorder.control.blocked()){return}var array=id.split("_");var historyData=Recorder.factory.createCountHistory(array[1],buttonName);if(Recorder.userData.timerecorder.need_password==="1"){historyData.credential_code=Recorder.Consts.CredentialCode.PASSWORD;if(className.indexOf("input-")>=0){Recorder.modal.showPassword(Recorder.control.showCountInputModal,historyData)}else{Recorder.modal.showPassword(Recorder.control.addCountConnect,historyData)}}else{if(className.indexOf("input-")>=0){Recorder.control.showCountInputModal(historyData)}else{Recorder.control.addCountConnect(historyData,null)}}};Control.prototype.showCountInputModal=function(historyData){Recorder.modal.showCountInput(Recorder.control.addCountConnect,historyData)};Control.prototype.addCountConnect=function(historyData,amount){Recorder.modal.showLoading();if(!amount){amount=1}historyData.amount=amount;var sendData=Recorder.factory.countHistoryToCountData(historyData,false);sendData.token=Recorder.userData.token.token_d;Recorder.network.connectServer({sendData:sendData,processData:historyData},Recorder.control.addCountConnectSuccess,Recorder.control.addCountConnectError,Recorder.Consts.GATEWAY_BASE)};Control.prototype.addCountConnectSuccess=function(data,status,xhr,historyData){historyData.xhr_statuc_code=xhr.status;historyData.send_timestamp=Recorder.utility.getFullDateString(new Date());var message="";if(!data||data.result==="NG"){var errorCode=data&&data.code?data.code:"";historyData.status=Recorder.Consts.HistoryStatus.RESULT_NG;historyData.error_code=errorCode?errorCode:Recorder.Consts.ErrorCode.AJAX_ERROR;if(!data||data.code==="998"){historyData.status=Recorder.Consts.HistoryStatus.SAVED_LOCAL;Recorder.storage.addLocalCount(historyData)}message=Recorder.i18N.getRecordErrorMessage(errorCode)}else{historyData.status=Recorder.Consts.HistoryStatus.RESULT_OK;message=Recorder.i18N.getMessage("026")}Recorder.storage.addCountHistory(historyData);Recorder.view.showLocalRecordInfo(Recorder.control.getLocalDataCount(),Recorder.control.sendLocalData);Recorder.modal.hide();Recorder.notification.showMessage(Recorder.utility.stringFormat(message,[historyData.name]))};Control.prototype.addCountConnectError=function(xhr,status,errorThrown,historyData){historyData.xhr_statuc_code=xhr.status;historyData.send_timestamp=Recorder.utility.getFullDateString(new Date());historyData.error_code=Recorder.Consts.ErrorCode.AJAX_ERROR;historyData.status=Recorder.Consts.HistoryStatus.RESULT_NG;var errorCodeForMessage="000";if(Recorder.network.isNeedSaveStatusByError(xhr.status,status)){errorCodeForMessage="";historyData.status=Recorder.Consts.HistoryStatus.SAVED_LOCAL;Recorder.storage.addLocalCount(historyData)}Recorder.storage.addCountHistory(historyData);Recorder.view.showLocalRecordInfo(Recorder.control.getLocalDataCount(),Recorder.control.sendLocalData);Recorder.modal.hide();Recorder.notification.showMessage(Recorder.utility.stringFormat(Recorder.i18N.getRecordErrorMessage(errorCodeForMessage),[historyData.name]))};Control.prototype.sendLocalData=function(isBackGround){if(!isBackGround){if(Recorder.control.blocked()){return}Recorder.modal.showLoading()}var sendOtherAccountDataOnly=true;var localDataCount=Recorder.control.getLocalDataCount();var localRecords=Recorder.storage.getLocalRecord();var localCounts=Recorder.storage.getLocalCount();var deferreds=[];if(!Recorder.utility.isEmptyArray(localRecords)){sendOtherAccountDataOnly=false;for(var i=0,l=localRecords.length;i<l;i++){deferreds.push(_sendLocalData(i,"record",localRecords))}}if(!Recorder.utility.isEmptyArray(localCounts)){sendOtherAccountDataOnly=false;for(var i=0,l=localCounts.length;i<l;i++){deferreds.push(_sendLocalData(i,"count",localCounts))}}var savedSuffix=Recorder.storage.getAllSavedSuffix();if(!Recorder.utility.isEmptyArray(savedSuffix)){for(var i=0,l=savedSuffix.length;i<l;i++){var suffix=savedSuffix[i];if(suffix===Recorder.userData.user.user_token){continue}var otherAccountLocalRecords=Recorder.storage.getLocalRecord(suffix);var otherAccountLocalCounts=Recorder.storage.getLocalCount(suffix);if(!Recorder.utility.isEmptyArray(otherAccountLocalRecords)){for(var i=0,l=otherAccountLocalRecords.length;i<l;i++){deferreds.push(_sendLocalData(i,"record",otherAccountLocalRecords,suffix))}}if(!Recorder.utility.isEmptyArray(otherAccountLocalCounts)){for(var i=0,l=otherAccountLocalCounts.length;i<l;i++){deferreds.push(_sendLocalData(i,"count",otherAccountLocalCounts,suffix))}}}}if(Recorder.utility.isEmptyArray(deferreds)){if(!isBackGround){Recorder.modal.hide()}return}$.when.apply($,deferreds).always(function(){Recorder.control.adjustLocalData();var currentLocalDataCount=Recorder.control.getLocalDataCount();var sendDataCount=localDataCount-currentLocalDataCount;Recorder.view.showLocalRecordInfo(currentLocalDataCount,Recorder.control.sendLocalData);if(!isBackGround){if(!sendOtherAccountDataOnly){if(sendDataCount===0){Recorder.notification.showMessage(Recorder.i18N.getMessage("027"))}else{Recorder.notification.showMessage(Recorder.utility.stringFormat(Recorder.i18N.getMessage("028"),[sendDataCount]))}}Recorder.modal.hide()}});function _sendLocalData(index,type,array,suffix){var isCount=type==="count"?true:false;var historyData=isCount?array[index]:array[index];var sendData=isCount?Recorder.factory.countHistoryToCountData(historyData,true):Recorder.factory.recordHistoryToRecordData(historyData,true);sendData.token=isCount?Recorder.userData.token.token_e:Recorder.userData.token.token_c;return $.ajax({url:Recorder.network.getBaseUrl()+Recorder.Consts.GATEWAY_BASE,data:sendData,type:"post",dataType:"json"}).done(function(data,textStatus,xhr){historyData.xhr_statuc_code=xhr.status;historyData.send_timestamp=Recorder.utility.getFullDateString(new Date());var sendStatus=Recorder.Consts.LocalTmpStatus.SENDED;if(!data||data.result==="NG"){historyData.status=Recorder.Consts.HistoryStatus.LOCAL_SEND_NG;historyData.error_code=data&&data.code?data.code:Recorder.Consts.ErrorCode.AJAX_ERROR;if(!data||data.code==="998"||data.code==="006"){sendStatus=Recorder.Consts.LocalTmpStatus.RE_SEND;historyData.status=Recorder.Consts.HistoryStatus.SAVED_LOCAL}}else{historyData.status=Recorder.Consts.HistoryStatus.LOCAL_SEND_OK;if(data.image_result){historyData.image_result=data.image_result}}if(isCount){Recorder.storage.addCountHistory(historyData,suffix)}else{Recorder.storage.addRecordHistory(historyData,suffix)}Recorder.storage.addLocalTmp({data:historyData,status:sendStatus},type,suffix)}).fail(function(xhr,textStatus,errorThrown){historyData.xhr_statuc_code=xhr.status;historyData.send_timestamp=Recorder.utility.getFullDateString(new Date());historyData.error_code=Recorder.Consts.ErrorCode.AJAX_ERROR;historyData.status=Recorder.Consts.HistoryStatus.LOCAL_SEND_NG;var sendStatus=Recorder.Consts.LocalTmpStatus.SENDED;if(Recorder.network.isNeedSaveStatusByError(xhr.status,textStatus)){historyData.status=Recorder.Consts.HistoryStatus.SAVED_LOCAL;sendStatus=Recorder.Consts.LocalTmpStatus.RE_SEND}if(isCount){Recorder.storage.addCountHistory(historyData,suffix)}else{Recorder.storage.addRecordHistory(historyData,suffix)}Recorder.storage.addLocalTmp({data:historyData,status:sendStatus},type,suffix)})}};Control.prototype.adjustLocalData=function(){var localRecords=Recorder.storage.getLocalRecord();var localRecordTmps=Recorder.storage.getLocalTmp("record");localRecords=Recorder.control.adjustOneLocalData(localRecords,localRecordTmps);if(Recorder.utility.isEmptyArray(localRecords)){Recorder.storage.removeLocalRecord()}else{Recorder.storage.saveLocalRecord(localRecords)}Recorder.storage.removeLocalTmp("record");var localCounts=Recorder.storage.getLocalCount();var localCountsTmps=Recorder.storage.getLocalTmp("count");localCounts=Recorder.control.adjustOneLocalData(localCounts,localCountsTmps);if(Recorder.utility.isEmptyArray(localCounts)){Recorder.storage.removeLocalCount()}else{Recorder.storage.saveLocalCount(localCounts)}Recorder.storage.removeLocalTmp("count");var savedSuffix=Recorder.storage.getAllSavedSuffix();if(!Recorder.utility.isEmptyArray(savedSuffix)){for(var i=0,l=savedSuffix.length;i<l;i++){var suffix=savedSuffix[i];if(suffix===Recorder.userData.user.user_token){continue}var otherAccountLocalRecords=Recorder.storage.getLocalRecord(suffix);var otherAccountLocalRecordTmps=Recorder.storage.getLocalTmp("record",suffix);otherAccountLocalRecords=Recorder.control.adjustOneLocalData(otherAccountLocalRecords,otherAccountLocalRecordTmps);if(Recorder.utility.isEmptyArray(otherAccountLocalRecords)){Recorder.storage.removeLocalRecord(suffix)}else{Recorder.storage.saveLocalRecord(otherAccountLocalRecords,suffix)}Recorder.storage.removeLocalTmp("record",suffix);var otherAccountLocalCounts=Recorder.storage.getLocalCount(suffix);var otherAccountLocalCountTmps=Recorder.storage.getLocalTmp("count",suffix);otherAccountLocalCounts=Recorder.control.adjustOneLocalData(otherAccountLocalCounts,otherAccountLocalCountTmps);if(Recorder.utility.isEmptyArray(otherAccountLocalCounts)){Recorder.storage.removeLocalCount(suffix)}else{Recorder.storage.saveLocalCount(otherAccountLocalCounts,suffix)}Recorder.storage.removeLocalTmp("count",suffix)}}};Control.prototype.adjustOneLocalData=function(orgLocalArray,tmpLocalArray){if(!Recorder.utility.isEmptyArray(orgLocalArray)&&!Recorder.utility.isEmptyArray(tmpLocalArray)){for(var i=0,l=tmpLocalArray.length;i<l;i++){var tmp=tmpLocalArray[i];for(var j=orgLocalArray.length-1;j>=0;j--){var org=orgLocalArray[j];if(tmp.status===Recorder.Consts.LocalTmpStatus.SENDED){if(tmp.data.id===org.id&&tmp.data.record_timestamp===org.record_timestamp){orgLocalArray.splice(j,1)}}}}}return orgLocalArray};Control.prototype.getLocalDataCount=function(){var count=0;var localRecords=Recorder.storage.getLocalRecord();var localCounts=Recorder.storage.getLocalCount();if(localRecords){count+=localRecords.length}if(localCounts){count+=localCounts.length}return count};Control.prototype.adjustAllWindowItem=function(){document.title=Recorder.i18N.getTitleName();Recorder.view.showNames(Recorder.userData.timerecorder.name,Recorder.userData.user.name);Recorder.control.setRecordButton(false);Recorder.control.setUpTimerecorders();Recorder.control.setMenuList();Recorder.announce.adjustAnnounceMessageBatch()};Control.prototype.setUpTimerecorders=function(){if(!(Recorder.userData.timerecorders&&Recorder.userData.timerecorders.length)){Recorder.view.cache.timerecorders.hide();return}Recorder.view.cache.timerecorders.children().remove();Recorder.view.cache.timerecorders.show();var compare=function(t1,t2){var c1=t1.sectionCode;var c2=t2.sectionCode;if(c1<c2){return -1}if(c1>c2){return 1}return 0};Recorder.userData.timerecorders.sort(compare);for(var i=0;i<Recorder.userData.timerecorders.length;i++){var t=Recorder.userData.timerecorders[i];Recorder.view.addTimerecorderOption(t)}};Control.prototype.setRecordButton=function(isCount){Recorder.view.clearButtons();Recorder.view.adjustButtonAlign(isCount);var array=isCount?Recorder.userData.timerecorder.count_button:Recorder.userData.timerecorder.record_button;for(var i=0,l=array.length;i<l;i++){if(isCount){var className="count";if(array[i].is_input==="1"){className="input-count"}Recorder.view.addButton(array[i].name,"count_"+array[i].id,className,array[i].mark,Recorder.control.clickCountButton)}else{Recorder.view.addButton(array[i].name,"record_"+array[i].id,"record",array[i].mark,Recorder.control.clickRecordButton)}}};Control.prototype.refresh=function(){if(Recorder.userData.timerecorder){Recorder.watch.refreshWatch();Recorder.geolocation.refreshLocation()}};Recorder.control=new Control()})(jQuery);(function(){function ServiceWorkerMessage(){}ServiceWorkerMessage.prototype.sendMessage=function(message){if(!navigator.serviceWorker){console.log("This function cannot be used because it does not support Service worker");return}const controller=navigator.serviceWorker.controller;if(!controller){console.log("This function cannot be used because controller is undefined");return}navigator.serviceWorker.controller.postMessage(message)};Recorder=Recorder||{};Recorder.serviceWorkerMessage=new ServiceWorkerMessage()})();